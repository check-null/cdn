import{d as D,a as r,i as E,r as n,c as U,o as z,B as a,A as l,E as H,C as L,n as M,F as N}from"./vlib-Cn1ZCOTB.js";import{b as m}from"./index-VyNxZgU2.js";const q=D({__name:"role-add-or-update",emits:["refreshDataList"],setup(R,{expose:C,emit:h}){const V=h,u=r(!1),_=r([]),v=r([]),p=r(),d=r(),i=r(),t=E({id:"",name:"",menuIdList:[],deptIdList:[],remark:""}),x=r({name:[{required:!0,message:"必填项不能为空",trigger:"blur"}]}),K=s=>{u.value=!0,t.id="",p.value&&p.value.resetFields(),M(()=>{d.value&&d.value.setCheckedKeys([]),i.value&&i.value.setCheckedKeys([]),Promise.all([w(),I()]).then(()=>{s&&F(s)})})},w=()=>m.get("/sys/menu/select").then(s=>{_.value=s.data}),I=()=>m.get("/sys/dept/list").then(s=>{v.value=s.data}),F=s=>{m.get(`/sys/role/${s}`).then(e=>{Object.assign(t,e.data),t.menuIdList.forEach(c=>d.value.setChecked(c,!0)),i.value.setCheckedKeys(t.deptIdList)})},k=()=>{p.value.validate(s=>{if(!s)return!1;t.menuIdList=[...d.value.getHalfCheckedKeys(),...d.value.getCheckedKeys()],t.deptIdList=i.value.getCheckedKeys(),(t.id?m.put:m.post)("/sys/role",t).then(e=>{N.success({message:"成功",duration:500,onClose:()=>{u.value=!1,V("refreshDataList")}})})})};return C({init:K}),(s,e)=>{const c=n("el-input"),f=n("el-form-item"),y=n("el-tree"),b=n("el-col"),T=n("el-row"),$=n("el-form"),g=n("el-button"),B=n("el-dialog");return z(),U(B,{modelValue:u.value,"onUpdate:modelValue":e[5]||(e[5]=o=>u.value=o),title:t.id?"修改":"新增","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:a(()=>[l(g,{onClick:e[3]||(e[3]=o=>u.value=!1)},{default:a(()=>e[6]||(e[6]=[L("取消")])),_:1}),l(g,{type:"primary",onClick:e[4]||(e[4]=o=>k())},{default:a(()=>e[7]||(e[7]=[L("确定")])),_:1})]),default:a(()=>[l($,{model:t,rules:x.value,ref_key:"dataFormRef",ref:p,onKeyup:e[2]||(e[2]=H(o=>k(),["enter"])),"label-width":"120px"},{default:a(()=>[l(f,{prop:"name",label:"名称"},{default:a(()=>[l(c,{modelValue:t.name,"onUpdate:modelValue":e[0]||(e[0]=o=>t.name=o),placeholder:"名称"},null,8,["modelValue"])]),_:1}),l(f,{prop:"remark",label:"备注"},{default:a(()=>[l(c,{modelValue:t.remark,"onUpdate:modelValue":e[1]||(e[1]=o=>t.remark=o),placeholder:"备注"},null,8,["modelValue"])]),_:1}),l(T,null,{default:a(()=>[l(b,{span:12},{default:a(()=>[l(f,{size:"small",label:"菜单授权"},{default:a(()=>[l(y,{data:_.value,props:{label:"name",children:"children"},"node-key":"id",ref_key:"menuListTree",ref:d,accordion:"","show-checkbox":""},null,8,["data"])]),_:1})]),_:1}),l(b,{span:12},{default:a(()=>[l(f,{size:"small",label:"数据授权"},{default:a(()=>[l(y,{data:v.value,props:{label:"name",children:"children"},"node-key":"id",ref_key:"deptListTree",ref:i,accordion:"","show-checkbox":""},null,8,["data"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}});export{q as _};
