import{d as N,a as $,i as x,m as T,r as p,f as V,g as U,o as l,A as a,e as E,B as n,C as i,c as r,I as u,E as F,F as f,P as c}from"./vlib-Cn1ZCOTB.js";import{u as I}from"./useView-DRWh0fDC.js";import{b as k}from"./index-VyNxZgU2.js";import{_ as O}from"./schedule-add-or-update.vue_vue_type_style_index_0_lang-YB5qe5wm.js";import{_ as j}from"./schedule-log.vue_vue_type_script_setup_true_lang-CR9GQ67h.js";import"./quill-BosuxZz1.js";import"./lodash-CIOfnQPl.js";const K={class:"mod-job__schedule"},Z=N({__name:"schedule",emits:["refreshDataList"],setup(M,{emit:A}){const C=$(),h=x({getDataListURL:"/sys/schedule/page",getDataListIsPage:!0,deleteURL:"/sys/schedule",deleteIsBatch:!0,dataForm:{beanName:""}}),t=x({...I(h),...T(h)}),L=o=>{if(!o&&t.dataListSelections&&t.dataListSelections.length<=0)return f({message:"请选择操作项",type:"warning",duration:500});c.confirm("确定进行[暂停]操作?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{k.put("/sys/schedule/pause",o?[o]:t.dataListSelections&&t.dataListSelections.map(e=>e.id)).then(e=>{f.success({message:"成功",duration:500,onClose:()=>{t.getDataList()}})})}).catch(()=>{})},_=o=>{if(!o&&t.dataListSelections&&t.dataListSelections.length<=0)return f({message:"请选择操作项",type:"warning",duration:500});c.confirm("确定进行[恢复]操作?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{k.put("/sys/schedule/resume",o?[o]:t.dataListSelections&&t.dataListSelections.map(e=>e.id)).then(e=>{f.success({message:"成功",duration:500,onClose:()=>{t.getDataList()}})})}).catch(()=>{})},v=o=>{if(!o&&t.dataListSelections&&t.dataListSelections.length<=0)return f({message:"请选择操作项",type:"warning",duration:500});c.confirm("确定进行[执行]操作?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{k.put("/sys/schedule/run",o?[o]:t.dataListSelections&&t.dataListSelections.map(e=>e.id)).then(e=>{f.success({message:"成功",duration:500,onClose:()=>{t.getDataList()}})})}).catch(()=>{})},D=()=>{C.value.init()},b=$(),w=o=>{b.value.init(o)};return(o,e)=>{const P=p("el-input"),m=p("el-form-item"),d=p("el-button"),B=p("el-form"),g=p("el-table-column"),S=p("el-tag"),H=p("el-table"),z=p("el-pagination"),R=V("loading");return l(),U("div",K,[a(B,{inline:!0,model:t.dataForm,onKeyup:e[8]||(e[8]=F(s=>t.getDataList(),["enter"]))},{default:n(()=>[a(m,null,{default:n(()=>[a(P,{modelValue:t.dataForm.beanName,"onUpdate:modelValue":e[0]||(e[0]=s=>t.dataForm.beanName=s),placeholder:"bean名称",clearable:""},null,8,["modelValue"])]),_:1}),a(m,null,{default:n(()=>[a(d,{onClick:e[1]||(e[1]=s=>t.getDataList())},{default:n(()=>e[9]||(e[9]=[i("查询")])),_:1})]),_:1}),a(m,null,{default:n(()=>[t.hasPermission("sys:schedule:save")?(l(),r(d,{key:0,type:"primary",onClick:e[2]||(e[2]=s=>w())},{default:n(()=>e[10]||(e[10]=[i("新增")])),_:1})):u("",!0)]),_:1}),a(m,null,{default:n(()=>[t.hasPermission("sys:schedule:delete")?(l(),r(d,{key:0,type:"danger",onClick:e[3]||(e[3]=s=>t.deleteHandle())},{default:n(()=>e[11]||(e[11]=[i("删除")])),_:1})):u("",!0)]),_:1}),a(m,null,{default:n(()=>[t.hasPermission("sys:schedule:pause")?(l(),r(d,{key:0,type:"danger",onClick:e[4]||(e[4]=s=>L())},{default:n(()=>e[12]||(e[12]=[i("暂停")])),_:1})):u("",!0)]),_:1}),a(m,null,{default:n(()=>[t.hasPermission("sys:schedule:resume")?(l(),r(d,{key:0,type:"danger",onClick:e[5]||(e[5]=s=>_())},{default:n(()=>e[13]||(e[13]=[i("恢复")])),_:1})):u("",!0)]),_:1}),a(m,null,{default:n(()=>[t.hasPermission("sys:schedule:run")?(l(),r(d,{key:0,type:"danger",onClick:e[6]||(e[6]=s=>v())},{default:n(()=>e[14]||(e[14]=[i("执行")])),_:1})):u("",!0)]),_:1}),a(m,null,{default:n(()=>[t.hasPermission("sys:schedule:log")?(l(),r(d,{key:0,type:"success",onClick:e[7]||(e[7]=s=>D())},{default:n(()=>e[15]||(e[15]=[i("日志列表")])),_:1})):u("",!0)]),_:1})]),_:1},8,["model"]),E((l(),r(H,{data:t.dataList,border:"",onSelectionChange:t.dataListSelectionChangeHandle,onSortChange:t.dataListSortChangeHandle,style:{width:"100%"}},{default:n(()=>[a(g,{type:"selection","header-align":"center",align:"center",width:"50"}),a(g,{prop:"beanName",label:"bean名称","header-align":"center",align:"center"}),a(g,{prop:"params",label:"参数","show-overflow-tooltip":"","header-align":"center",align:"center"}),a(g,{prop:"cronExpression",label:"cron表达式","header-align":"center",align:"center"}),a(g,{prop:"remark",label:"备注","show-overflow-tooltip":"","header-align":"center",align:"center"}),a(g,{prop:"status",label:"状态",sortable:"custom","header-align":"center",align:"center"},{default:n(s=>[s.row.status===1?(l(),r(S,{key:0,size:"small"},{default:n(()=>e[16]||(e[16]=[i("正常")])),_:1})):(l(),r(S,{key:1,size:"small",type:"danger"},{default:n(()=>e[17]||(e[17]=[i("暂停")])),_:1}))]),_:1}),a(g,{label:"操作",fixed:"right","header-align":"center",align:"center",width:"248"},{default:n(s=>[t.hasPermission("sys:schedule:update")?(l(),r(d,{key:0,type:"primary",link:"",onClick:y=>w(s.row.id)},{default:n(()=>e[18]||(e[18]=[i("修改")])),_:2},1032,["onClick"])):u("",!0),t.hasPermission("sys:schedule:pause")?(l(),r(d,{key:1,type:"primary",link:"",onClick:y=>L(s.row.id)},{default:n(()=>e[19]||(e[19]=[i("暂停")])),_:2},1032,["onClick"])):u("",!0),t.hasPermission("sys:schedule:resume")?(l(),r(d,{key:2,type:"primary",link:"",onClick:y=>_(s.row.id)},{default:n(()=>e[20]||(e[20]=[i("恢复")])),_:2},1032,["onClick"])):u("",!0),t.hasPermission("sys:schedule:run")?(l(),r(d,{key:3,type:"primary",link:"",onClick:y=>v(s.row.id)},{default:n(()=>e[21]||(e[21]=[i("执行")])),_:2},1032,["onClick"])):u("",!0),t.hasPermission("sys:schedule:delete")?(l(),r(d,{key:4,type:"primary",link:"",onClick:y=>t.deleteHandle(s.row.id)},{default:n(()=>e[22]||(e[22]=[i("删除")])),_:2},1032,["onClick"])):u("",!0)]),_:1})]),_:1},8,["data","onSelectionChange","onSortChange"])),[[R,t.dataListLoading]]),a(z,{"current-page":t.page,"page-sizes":[10,20,50,100],"page-size":t.limit,total:t.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:t.pageSizeChangeHandle,onCurrentChange:t.pageCurrentChangeHandle},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"]),a(O,{ref_key:"addOrUpdateRef",ref:b,onRefreshDataList:t.getDataList},null,8,["onRefreshDataList"]),a(j,{ref_key:"logRef",ref:C},null,512)])}}});export{Z as default};
