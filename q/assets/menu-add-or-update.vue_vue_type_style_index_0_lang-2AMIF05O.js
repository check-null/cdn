import{d as G,a as i,i as Q,r as s,c as m,o as u,B as o,A as n,E as W,I as v,C as f,h as y,a7 as X,g as $,J as Y,K as Z,L as ee,F as le}from"./vlib-Cn1ZCOTB.js";import{d as B,b as g}from"./index-VyNxZgU2.js";const oe={class:"popover-pop-body"},te={class:"mod-sys__menu-icon-inner"},ne={class:"mod-sys__menu-icon-list"},ae={class:"icon-svg","aria-hidden":"true"},se=["xlink:href"],pe=G({__name:"menu-add-or-update",emits:["refreshDataList"],setup(re,{expose:w,emit:H}){const K=H,d=i(!1),k=i([]),V=i([]),p=i(),C=i(),L=i(),N=i(),l=Q({id:"",menuType:0,name:"",pid:"0",parentName:"",url:"",permissions:"",sort:0,icon:"",openStyle:0}),P=i({name:[{required:!0,message:"必填项不能为空",trigger:"blur"}],parentName:[{required:!0,message:"必填项不能为空",trigger:"change"}]}),D=a=>{d.value=!0,l.id="",p.value&&p.value.resetFields(),V.value=B(),l.pid="0",l.parentName="一级菜单",T().then(()=>{a&&I(a)})},E=a=>{d.value=!0,p.value&&p.value.resetFields(),V.value=B(),l.id="",l.pid=a.id,l.parentName=a.name,T()},T=()=>g.get("/sys/menu/list?type=0").then(a=>{k.value=a.data}),I=a=>{g.get(`/sys/menu/${a}`).then(e=>{if(Object.assign(l,e.data),l.pid==="0")return x();C.value.setCurrentKey(l.pid)})},x=()=>{l.pid="0",l.parentName="一级菜单"},M=a=>{l.pid=a.id,l.parentName=a.name,L.value.hide()},q=a=>{l.icon=a,N.value.hide()},U=()=>{p.value.validate(a=>{if(!a)return!1;(l.id?g.put:g.post)("/sys/menu",l).then(e=>{le.success({message:"成功",duration:500,onClose:()=>{d.value=!1,K("refreshDataList")}})})})};return w({init:D,init2:E}),(a,e)=>{const _=s("el-radio"),F=s("el-radio-group"),r=s("el-form-item"),c=s("el-input"),R=s("circle-close"),j=s("el-icon"),z=s("el-tree"),S=s("el-popover"),A=s("el-input-number"),b=s("el-button"),J=s("el-form"),O=s("el-dialog");return u(),m(O,{modelValue:d.value,"onUpdate:modelValue":e[12]||(e[12]=t=>d.value=t),title:l.id?"修改":"新增","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:o(()=>[n(b,{onClick:e[10]||(e[10]=t=>d.value=!1)},{default:o(()=>e[17]||(e[17]=[f("取消")])),_:1}),n(b,{type:"primary",onClick:e[11]||(e[11]=t=>U())},{default:o(()=>e[18]||(e[18]=[f("确定")])),_:1})]),default:o(()=>[n(J,{model:l,rules:P.value,ref_key:"dataFormRef",ref:p,onKeyup:e[9]||(e[9]=W(t=>U(),["enter"])),"label-width":"120px"},{default:o(()=>[n(r,{prop:"menuType",label:"类型"},{default:o(()=>[n(F,{modelValue:l.menuType,"onUpdate:modelValue":e[0]||(e[0]=t=>l.menuType=t),disabled:!!l.id},{default:o(()=>[n(_,{label:0},{default:o(()=>e[13]||(e[13]=[f("菜单")])),_:1}),n(_,{label:1},{default:o(()=>e[14]||(e[14]=[f("按钮")])),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),n(r,{prop:"name",label:"名称"},{default:o(()=>[n(c,{modelValue:l.name,"onUpdate:modelValue":e[1]||(e[1]=t=>l.name=t),placeholder:"名称"},null,8,["modelValue"])]),_:1}),n(r,{prop:"parentName",label:"上级菜单",class:"menu-list"},{default:o(()=>[n(S,{ref_key:"menuListPopover",ref:L,placement:"bottom-start",trigger:"click",width:400,"popper-class":"popover-pop"},{reference:o(()=>[n(c,{modelValue:l.parentName,"onUpdate:modelValue":e[3]||(e[3]=t=>l.parentName=t),readonly:!0,placeholder:"上级菜单"},{suffix:o(()=>[l.pid!=="0"?(u(),m(j,{key:0,onClick:e[2]||(e[2]=X(t=>x(),["stop"])),class:"el-input__icon"},{default:o(()=>[n(R)]),_:1})):v("",!0)]),_:1},8,["modelValue"])]),default:o(()=>[y("div",oe,[n(z,{data:k.value,props:{label:"name",children:"children"},"node-key":"id",ref_key:"menuListTree",ref:C,"highlight-current":!0,"expand-on-click-node":!1,accordion:"",onCurrentChange:M},null,8,["data"])])]),_:1},512)]),_:1}),l.menuType===0?(u(),m(r,{key:0,prop:"url",label:"路由"},{default:o(()=>[n(c,{modelValue:l.url,"onUpdate:modelValue":e[4]||(e[4]=t=>l.url=t),placeholder:"路由"},null,8,["modelValue"])]),_:1})):v("",!0),n(r,{prop:"sort",label:"排序"},{default:o(()=>[n(A,{modelValue:l.sort,"onUpdate:modelValue":e[5]||(e[5]=t=>l.sort=t),"controls-position":"right",min:0,label:"排序"},null,8,["modelValue"])]),_:1}),l.menuType===0?(u(),m(r,{key:1,prop:"openStyle",label:"打开方式"},{default:o(()=>[n(F,{modelValue:l.openStyle,"onUpdate:modelValue":e[6]||(e[6]=t=>l.openStyle=t)},{default:o(()=>[n(_,{label:0},{default:o(()=>e[15]||(e[15]=[f("内部打开")])),_:1}),n(_,{label:1},{default:o(()=>e[16]||(e[16]=[f("外部打开")])),_:1})]),_:1},8,["modelValue"])]),_:1})):v("",!0),n(r,{prop:"permissions",label:"授权标识"},{default:o(()=>[n(c,{modelValue:l.permissions,"onUpdate:modelValue":e[7]||(e[7]=t=>l.permissions=t),placeholder:"多个用逗号分隔，如：sys:menu:save,sys:menu:update"},null,8,["modelValue"])]),_:1}),l.menuType===0?(u(),m(r,{key:2,prop:"icon",label:"图标",class:"icon-list"},{default:o(()=>[n(S,{ref_key:"iconListPopover",ref:N,placement:"top-start",trigger:"click","popper-class":"popover-pop mod-sys__menu-icon-popover"},{reference:o(()=>[n(c,{modelValue:l.icon,"onUpdate:modelValue":e[8]||(e[8]=t=>l.icon=t),readonly:!0,placeholder:"图标"},null,8,["modelValue"])]),default:o(()=>[y("div",te,[y("div",ne,[(u(!0),$(Y,null,Z(V.value,(t,h)=>(u(),m(b,{key:h,onClick:ie=>q(t),class:ee({"is-active":l.icon===t})},{default:o(()=>[(u(),$("svg",ae,[y("use",{"xlink:href":`#${t}`},null,8,se)]))]),_:2},1032,["onClick","class"]))),128))])])]),_:1},512)]),_:1})):v("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}});export{pe as _};
