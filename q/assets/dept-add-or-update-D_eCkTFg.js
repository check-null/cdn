import{d as E,a as r,i as M,q as O,r as n,c as y,o as C,B as s,A as a,E as P,h as R,I as j,a7 as z,C as k,F as N}from"./vlib-Cn1ZCOTB.js";import{u as G,b as i,_ as J}from"./index-9CjrkANP.js";import"./quill-BosuxZz1.js";import"./lodash-CIOfnQPl.js";const Q={class:"popover-pop-body"},W=E({__name:"dept-add-or-update",emits:["refreshDataList"],setup(X,{expose:L,emit:x}){const c=G(),h=x,p=r(!1),d=r(),f=r([]),_=r(),v=r(),t=M({id:"",name:"",pid:"",parentName:"",sort:0}),F=O(()=>c.state.user),w=r({name:[{required:!0,message:"必填项不能为空",trigger:"blur"}],parentName:[{required:!0,message:"必填项不能为空",trigger:"change"}]}),A=o=>{p.value=!0,t.id="",d.value&&d.value.resetFields(),T().then(()=>{o?U(o):c.state.user.superAdmin===1&&u()})},T=()=>i.get("/sys/dept/list").then(o=>{if(o.code!==0)return N.error(o.msg);f.value=o.data}),U=o=>{i.get(`/sys/dept/${o}`).then(e=>{if(Object.assign(t,e.data),t.pid==="0")return u();v.value.setCurrentKey(t.pid)})},u=()=>{t.pid="0",t.parentName="一级部门"},$=o=>{t.pid=o.id,t.parentName=o.name,_.value.hide()},g=()=>{d.value.validate(o=>{if(!o)return!1;(t.id?i.put:i.post)("/sys/dept",t).then(e=>{N.success({message:"成功",duration:500,onClose:()=>{p.value=!1,h("refreshDataList")}})})})};return L({init:A}),(o,e)=>{const b=n("el-input"),m=n("el-form-item"),B=n("circle-close"),D=n("el-icon"),S=n("el-tree"),q=n("el-popover"),H=n("el-input-number"),I=n("el-form"),V=n("el-button"),K=n("el-dialog");return C(),y(K,{modelValue:p.value,"onUpdate:modelValue":e[7]||(e[7]=l=>p.value=l),title:t.id?"修改":"新增","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:s(()=>[a(V,{onClick:e[5]||(e[5]=l=>p.value=!1)},{default:s(()=>e[8]||(e[8]=[k("取消")])),_:1}),a(V,{type:"primary",onClick:e[6]||(e[6]=l=>g())},{default:s(()=>e[9]||(e[9]=[k("确定")])),_:1})]),default:s(()=>[a(I,{model:t,rules:w.value,ref_key:"dataFormRef",ref:d,onKeyup:e[4]||(e[4]=P(l=>g(),["enter"])),"label-width":"120px"},{default:s(()=>[a(m,{prop:"name",label:"名称"},{default:s(()=>[a(b,{modelValue:t.name,"onUpdate:modelValue":e[0]||(e[0]=l=>t.name=l),placeholder:"名称"},null,8,["modelValue"])]),_:1}),a(m,{prop:"parentName",label:"上级部门",class:"dept-list"},{default:s(()=>[a(q,{width:400,ref_key:"deptListPopover",ref:_,placement:"bottom-start",trigger:"click","popper-class":"popover-pop"},{reference:s(()=>[a(b,{modelValue:t.parentName,"onUpdate:modelValue":e[2]||(e[2]=l=>t.parentName=l),readonly:!0,placeholder:"上级部门"},{suffix:s(()=>[F.value.superAdmin===1&&t.pid!=="0"?(C(),y(D,{key:0,onClick:e[1]||(e[1]=z(l=>u(),["stop"])),class:"el-input__icon"},{default:s(()=>[a(B)]),_:1})):j("",!0)]),_:1},8,["modelValue"])]),default:s(()=>[R("div",Q,[a(S,{data:f.value,props:{label:"name",children:"children"},"node-key":"id",ref_key:"deptListTree",ref:v,"highlight-current":!0,"expand-on-click-node":!1,accordion:"",onCurrentChange:$},null,8,["data"])])]),_:1},512)]),_:1}),a(m,{prop:"sort",label:"排序"},{default:s(()=>[a(H,{modelValue:t.sort,"onUpdate:modelValue":e[3]||(e[3]=l=>t.sort=l),"controls-position":"right",min:0,label:"排序"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),oe=J(W,[["__scopeId","data-v-08a1af11"]]);export{oe as default};
