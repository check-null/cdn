import{u as L,r as d,e as I,E as h,f as l,h as c,c as y,q as D,g as T,b as g,i as b,j as S}from"./index-VyNxZgU2.js";import{z as P,u as w,b as R,a8 as q,F as u,P as C}from"./vlib-Cn1ZCOTB.js";const N=p=>{const m=P(),o=w(),r=L(),e=((t,a)=>{for(const i in t)Object.getOwnPropertyDescriptor(a,i)||(a[i]=t[i]);return a})({createdIsNeed:!0,activatedIsNeed:!1,getDataListURL:"",getDataListIsPage:!1,deleteURL:"",deleteIsBatch:!1,deleteIsBatchKey:"id",exportURL:"",dataForm:{},dataList:[],order:"",orderField:"",page:1,limit:10,total:0,dataListLoading:!1,dataListSelections:[],elTable:{}},p);R(()=>{e.createdIsNeed&&!e.activatedIsNeed&&s.query()}),q(()=>{if(r.state.closedTabs.includes(r.state.activeTabName)){const t=r.state.closedTabs;r.updateState({closedTabs:t.filter(a=>a!==r.state.activeTabName)}),l.emit(c.OnReloadTabPage)}e.activatedIsNeed&&s.query()});const f={hasPermission(t){return S(r.state.permissions,t)},getDictLabel(t,a){return b(r.state.dicts,t,a)}},s={query(){e.getDataListURL&&(e.dataListLoading=!0,g.get(e.getDataListURL,{order:e.order,orderField:e.orderField,page:e.getDataListIsPage?e.page:null,limit:e.getDataListIsPage?e.limit:null,...e.dataForm}).then(t=>{e.dataListLoading=!1,e.dataList=e.getDataListIsPage?t.data.list:t.data,e.total=e.getDataListIsPage?t.data.total:0}).catch(()=>{e.dataListLoading=!1}))},dataListSelectionChangeHandle(t){e.dataListSelections=t},dataListSortChangeHandle(t){if(!t.order||!t.prop)return e.order="",e.orderField="",!1;e.order=t.order.replace(/ending$/,""),e.orderField=t.prop.replace(/([A-Z])/g,"_$1").toLowerCase(),s.query()},pageSizeChangeHandle(t){e.page=1,e.limit=t,s.query()},pageCurrentChangeHandle(t){e.page=t,s.query()},getDataList(){e.page=1,s.query()},deleteHandle(t){return new Promise((a,i)=>{if(e.deleteIsBatch&&!t&&e.dataListSelections&&e.dataListSelections.length<=0){u.warning({message:"请选择操作项",duration:500});return}C.confirm("确定进行[删除]操作?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{g.delete(`${e.deleteURL}${e.deleteIsBatch?"":"/"+t}`,e.deleteIsBatch?t?[t]:e.dataListSelections?e.dataListSelections.map(n=>e.deleteIsBatchKey&&n[e.deleteIsBatchKey]):{}:{}).then(n=>{u.success({message:"成功",duration:500,onClose:()=>{s.query(),a(!0)}})})}).catch(()=>{})})},exportHandle(){window.location.href=`${y.api}${e.exportURL}?${D.stringify({...e.dataForm,token:T()})}`},closeCurrentTab(){I(h.OpenTabsPage)?l.emit(c.OnCloseCurrTab):m.replace("/home")},handleFlowRoute(t){const a={path:"/flow/task-form",query:{taskId:t.taskId,processInstanceId:t.processInstanceId,processDefinitionId:t.processDefinitionId,showType:"taskHandle",_mt:`${o.meta.title} - ${t.processDefinitionName}`}};d(a)},flowDetailRoute(t){const a={path:"/flow/task-form",query:{taskId:t.taskId,processInstanceId:t.processInstanceId,processDefinitionId:t.processDefinitionId,showType:"detail",_mt:`${o.meta.title} - ${t.processDefinitionName}`}};d(a)}};return{...s,...f}};export{N as u};
