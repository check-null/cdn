import{_ as ee,r,a as te,n as B,o as ae,g as d,V as M,c as le,b as p,d as R,P as m,e as a,y as f,w as l,m as i,A as b,i as U,h as $,G as oe,p as T,E as A}from"./index-BxFS-j2d.js";import{u as ne}from"./useIsMobile-yINUZpTF.js";const de={class:"page-container"},se={class:"action-bar"},re={class:"total-count"},ie={__name:"index",setup(ue){const g=r(!1),h=r(!1),k=r([]),S=r(),u=r(!1),V=r(),{isMobile:x}=ne(),_=r(!0),C=r(0),I=r(0),t=te({id:null,parentId:0,categoryName:"",weight:1,sort:0}),j=B(()=>t.id?"编辑分类":"新增分类"),F=B(()=>[{id:"0",categoryName:"顶级分类",children:k.value}]),G={categoryName:[{required:!0,message:"请输入分类名称",trigger:"blur"}],weight:[{required:!0,message:"请设置权重",trigger:"change"}],parentId:[{required:!0,message:"请选择上级分类",trigger:"change"}]},w=()=>{g.value=!0,$("/category/tree").then(n=>{k.value=n.data,I.value=(n.data||[]).reduce((e,s)=>e+(s.questionCount||0),0),g.value=!1}).catch(()=>{g.value=!1})},K=()=>{_.value=!_.value,C.value++},N=()=>{t.id=null,t.parentId="0",t.categoryName="",t.weight=1,t.sort=0},D=n=>{N(),t.parentId=n===0?"0":n,u.value=!0},L=n=>{N(),$("/category/info",{id:n.id}).then(e=>{Object.assign(t,e.data),t.parentId=e.data.parentId===0?"0":e.data.parentId,u.value=!0}).catch(()=>{})},O=()=>{V.value.validate().then(()=>{h.value=!0;const n=t.id?"/category/update":"/category/save",e={...t,parentId:t.parentId==="0"?0:t.parentId};T(n,e).then(()=>{A.success(t.id?"修改成功":"新增成功"),u.value=!1,w()}).catch(()=>{}).finally(()=>{h.value=!1})}).catch(()=>{})},P=n=>{oe.confirm("确定要删除该分类吗？","提示",{type:"warning"}).then(()=>{T("/category/delete",{id:n.id}).then(()=>{A.success("删除成功"),w()}).catch(()=>{})}).catch(()=>{})};return ae(()=>{w()}),(n,e)=>{const s=d("el-button"),c=d("el-table-column"),E=d("el-tag"),Q=d("el-table"),W=d("el-tree-select"),v=d("el-form-item"),z=d("el-input"),H=d("el-slider"),J=d("el-input-number"),X=d("el-form"),Y=d("el-dialog"),y=M("permission"),Z=M("loading");return p(),le("div",de,[R("div",se,[m((p(),f(s,{type:"primary",onClick:e[0]||(e[0]=o=>D(0))},{default:l(()=>[...e[7]||(e[7]=[i("新增",-1)])]),_:1})),[[y,"category:save"]]),a(s,{onClick:K},{default:l(()=>[i(b(_.value?"全部收起":"全部展开"),1)]),_:1}),R("span",re,"总题目数："+b(I.value),1)]),m((p(),f(Q,{ref_key:"tableRef",ref:S,data:k.value,"element-loading-delay":200,"element-loading-background":"transparent","row-key":"id","tree-props":{children:"children"},"default-expand-all":_.value,key:C.value,class:"data-table"},{default:l(()=>[a(c,{prop:"categoryName",label:"分类名称","min-width":"200"}),a(c,{prop:"weight",label:"权重",width:"100"},{default:l(({row:o})=>[a(E,{type:"info"},{default:l(()=>[i(b(o.weight),1)]),_:2},1024)]),_:1}),a(c,{prop:"questionCount",label:"题目数量",width:"100"},{default:l(({row:o})=>[a(E,{type:"success"},{default:l(()=>[i(b(o.questionCount||0),1)]),_:2},1024)]),_:1}),a(c,{prop:"sort",label:"排序",width:"80"}),a(c,{prop:"createTime",label:"创建时间",width:"170"}),a(c,{label:"操作",width:"200",fixed:U(x)?!1:"right"},{default:l(({row:o})=>[m((p(),f(s,{link:"",type:"primary",onClick:q=>D(o.id)},{default:l(()=>[...e[8]||(e[8]=[i("新增子级",-1)])]),_:1},8,["onClick"])),[[y,"category:save"]]),m((p(),f(s,{link:"",type:"primary",onClick:q=>L(o)},{default:l(()=>[...e[9]||(e[9]=[i("编辑",-1)])]),_:1},8,["onClick"])),[[y,"category:update"]]),m((p(),f(s,{link:"",type:"danger",onClick:q=>P(o)},{default:l(()=>[...e[10]||(e[10]=[i("删除",-1)])]),_:1},8,["onClick"])),[[y,"category:delete"]])]),_:1},8,["fixed"])]),_:1},8,["data","default-expand-all"])),[[Z,g.value]]),a(Y,{modelValue:u.value,"onUpdate:modelValue":e[6]||(e[6]=o=>u.value=o),title:j.value,width:"500px",fullscreen:U(x),"close-on-click-modal":!1},{footer:l(()=>[a(s,{onClick:e[5]||(e[5]=o=>u.value=!1)},{default:l(()=>[...e[11]||(e[11]=[i("取消",-1)])]),_:1}),a(s,{type:"primary",loading:h.value,onClick:O},{default:l(()=>[...e[12]||(e[12]=[i("确定",-1)])]),_:1},8,["loading"])]),default:l(()=>[a(X,{ref_key:"formRef",ref:V,model:t,rules:G,"label-width":"100px"},{default:l(()=>[a(v,{label:"上级分类",prop:"parentId"},{default:l(()=>[a(W,{modelValue:t.parentId,"onUpdate:modelValue":e[1]||(e[1]=o=>t.parentId=o),data:F.value,props:{label:"categoryName",children:"children",value:"id"},"check-strictly":"","render-after-expand":!1,placeholder:"请选择上级分类",style:{width:"100%"}},null,8,["modelValue","data"])]),_:1}),a(v,{label:"分类名称",prop:"categoryName"},{default:l(()=>[a(z,{modelValue:t.categoryName,"onUpdate:modelValue":e[2]||(e[2]=o=>t.categoryName=o),placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1}),a(v,{label:"权重",prop:"weight"},{default:l(()=>[a(H,{modelValue:t.weight,"onUpdate:modelValue":e[3]||(e[3]=o=>t.weight=o),min:1,max:100,"show-input":""},null,8,["modelValue"])]),_:1}),a(v,{label:"排序",prop:"sort"},{default:l(()=>[a(J,{modelValue:t.sort,"onUpdate:modelValue":e[4]||(e[4]=o=>t.sort=o),min:0,max:999},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title","fullscreen"])])}}},me=ee(ie,[["__scopeId","data-v-29648bbd"]]);export{me as default};
