import{_ as ge,r as i,a as j,n as F,o as me,g as u,V as K,c as ve,b as h,d as L,P as b,e as t,f as fe,w as n,m as g,y as _,i as he,h as S,G as A,p as D,E as I,M as G}from"./index-C5MNrwrl.js";import{V as ye}from"./index-CIWRrSKe.js";import{M as be}from"./MobilePagination-B5Jb_x6V.js";import{u as _e}from"./useIsMobile-CnPPLxMk.js";const Ve={class:"page-container"},Ce={class:"search-bar"},ke={__name:"index",setup(we){const V=i(!1),q=i(!1),U=i([]),N=i(0),r=i(1),C=i(10),{isMobile:O}=_e(),k=i([]),v=i(!1),B=i(),H=i([]),P=i([]);let c=null;const p=j({title:"",categoryId:null}),a=j({id:null,title:"",content:"",categoryId:null}),J=F(()=>a.id?"编辑题目":"新增题目"),Q={title:[{required:!0,message:"请输入标题",trigger:"blur"}],categoryId:[{required:!0,message:"请选择分类",trigger:"change"}]},E=F(()=>Math.ceil(N.value/C.value)||1),d=()=>{V.value=!0,S("/question/page",{pageNum:r.value,pageSize:C.value,title:p.title,categoryId:p.categoryId}).then(l=>{U.value=l.data.records||[],N.value=Number(l.data.total)||0,V.value=!1}).catch(()=>{V.value=!1})},W=()=>{S("/category/tree").then(l=>{P.value=l.data||[];const e=w=>{const y=[],s=m=>{m.forEach(f=>{!f.children||f.children.length===0?y.push(f):s(f.children)})};return s(w),y};H.value=e(l.data||[])}).catch(()=>{})},T=()=>{G(()=>{d()})},X=()=>{r.value>1&&(r.value--,d())},Y=()=>{r.value<E.value&&(r.value++,d())},Z=l=>{r.value=l,d()},M=()=>{r.value=1,d()},ee=()=>{p.title="",p.categoryId=null,M()},te=l=>{k.value=l.map(e=>e.id)},$=()=>{a.id=null,a.title="",a.content="",a.categoryId=null},R=(l="")=>{G(()=>{c&&c.destroy(),c=new ye("vditor",{height:"50vh",width:"100%",mode:"ir",placeholder:"请输入内容(支持Markdown)",cache:{enable:!1},cdn:"./vditor",after:()=>{c.setValue(l)}})})},le=()=>{$(),v.value=!0,R("")},ae=l=>{$(),S("/question/info",{id:l.id}).then(e=>{Object.assign(a,e.data),v.value=!0,R(a.content||"")}).catch(()=>{})},oe=()=>{B.value.validate().then(()=>{if(a.content=c?.getValue()||"",!a.content.trim()){I.warning("请输入内容");return}q.value=!0;const l=a.id?"/question/update":"/question/save";D(l,a).then(()=>{I.success(a.id?"修改成功":"新增成功"),v.value=!1,d()}).catch(()=>{}).finally(()=>{q.value=!1})}).catch(()=>{})},ne=l=>{A.confirm("确定要删除该题目吗？","提示",{type:"warning"}).then(()=>{D("/question/delete",[l.id]).then(()=>{I.success("删除成功"),d()}).catch(()=>{})}).catch(()=>{})},se=()=>{A.confirm(`确定要删除选中的 ${k.value.length} 个题目吗？`,"提示",{type:"warning"}).then(()=>{D("/question/delete",k.value).then(()=>{I.success("删除成功"),d()}).catch(()=>{})}).catch(()=>{})},ie=()=>{c&&(c.destroy(),c=null)};return me(()=>{d(),W()}),(l,e)=>{const w=u("el-input"),y=u("el-tree-select"),s=u("el-button"),m=u("el-table-column"),f=u("el-table"),re=u("el-pagination"),z=u("el-form-item"),de=u("el-form"),ue=u("el-dialog"),x=K("permission"),ce=K("loading");return h(),ve("div",Ve,[L("div",Ce,[t(w,{modelValue:p.title,"onUpdate:modelValue":e[0]||(e[0]=o=>p.title=o),placeholder:"题目标题",clearable:"",class:"search-input",onKeyup:fe(M,["enter"])},null,8,["modelValue"]),t(y,{modelValue:p.categoryId,"onUpdate:modelValue":e[1]||(e[1]=o=>p.categoryId=o),data:P.value,props:{label:"categoryName",children:"children",value:"id"},placeholder:"选择分类",clearable:"","check-strictly":"","render-after-expand":!1,class:"search-select"},null,8,["modelValue","data"]),t(s,{type:"primary",onClick:M},{default:n(()=>[...e[8]||(e[8]=[g("搜索",-1)])]),_:1}),t(s,{onClick:ee},{default:n(()=>[...e[9]||(e[9]=[g("重置",-1)])]),_:1}),b((h(),_(s,{type:"primary",onClick:le},{default:n(()=>[...e[10]||(e[10]=[g("新增",-1)])]),_:1})),[[x,"question:save"]]),b((h(),_(s,{type:"danger",disabled:!k.value.length,onClick:se},{default:n(()=>[...e[11]||(e[11]=[g("批量删除",-1)])]),_:1},8,["disabled"])),[[x,"question:delete"]])]),b((h(),_(f,{data:U.value,"element-loading-delay":200,"element-loading-background":"transparent",onSelectionChange:te,class:"data-table"},{default:n(()=>[t(m,{type:"selection",width:"50"}),t(m,{prop:"title",label:"标题","min-width":"200","show-overflow-tooltip":""}),t(m,{prop:"categoryName",label:"分类",width:"150"}),t(m,{prop:"createTime",label:"创建时间",width:"170"}),t(m,{label:"操作",width:"150",fixed:he(O)?!1:"right"},{default:n(({row:o})=>[b((h(),_(s,{link:"",type:"primary",onClick:pe=>ae(o)},{default:n(()=>[...e[12]||(e[12]=[g("编辑",-1)])]),_:1},8,["onClick"])),[[x,"question:update"]]),b((h(),_(s,{link:"",type:"danger",onClick:pe=>ne(o)},{default:n(()=>[...e[13]||(e[13]=[g("删除",-1)])]),_:1},8,["onClick"])),[[x,"question:delete"]])]),_:1},8,["fixed"])]),_:1},8,["data"])),[[ce,V.value]]),t(re,{"current-page":r.value,"onUpdate:currentPage":e[2]||(e[2]=o=>r.value=o),"page-size":C.value,"onUpdate:pageSize":e[3]||(e[3]=o=>C.value=o),total:N.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",class:"pagination",onSizeChange:T,onCurrentChange:T},null,8,["current-page","page-size","total"]),t(be,{"current-page":r.value,"total-pages":E.value,onPrev:X,onNext:Y,onPageChange:Z,class:"mobile-pagination"},null,8,["current-page","total-pages"]),t(ue,{modelValue:v.value,"onUpdate:modelValue":e[7]||(e[7]=o=>v.value=o),title:J.value,"close-on-click-modal":!1,onClosed:ie},{footer:n(()=>[t(s,{onClick:e[6]||(e[6]=o=>v.value=!1)},{default:n(()=>[...e[15]||(e[15]=[g("取消",-1)])]),_:1}),t(s,{type:"primary",loading:q.value,onClick:oe},{default:n(()=>[...e[16]||(e[16]=[g("确定",-1)])]),_:1},8,["loading"])]),default:n(()=>[t(de,{ref_key:"formRef",ref:B,model:a,rules:Q,"label-width":"80px"},{default:n(()=>[t(z,{label:"标题",prop:"title"},{default:n(()=>[t(w,{modelValue:a.title,"onUpdate:modelValue":e[4]||(e[4]=o=>a.title=o),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),t(z,{label:"分类",prop:"categoryId"},{default:n(()=>[t(y,{modelValue:a.categoryId,"onUpdate:modelValue":e[5]||(e[5]=o=>a.categoryId=o),data:P.value,props:{label:"categoryName",children:"children",value:"id"},placeholder:"请选择分类","check-strictly":"","render-after-expand":!1,style:{width:"100%"}},null,8,["modelValue","data"])]),_:1}),t(z,{label:"内容",prop:"content"},{default:n(()=>[...e[14]||(e[14]=[L("div",{id:"vditor",class:"vditor-container",style:{width:"auto"}},null,-1)])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Pe=ge(ke,[["__scopeId","data-v-d2d16878"]]);export{Pe as default};
