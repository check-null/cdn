import{_ as ie,r as s,a as E,n as R,o as ue,g as u,V as $,c as ce,b as f,d as me,P as h,e as a,f as pe,w as t,m,y,i as ge,h as I,M as K,G as j,p as N,E as z}from"./index-C5MNrwrl.js";import{M as ve}from"./MobilePagination-B5Jb_x6V.js";import{u as fe}from"./useIsMobile-CnPPLxMk.js";const he={class:"page-container"},ye={class:"search-bar"},_e={__name:"index",setup(be){const _=s(!1),V=s(!1),S=s([]),w=s(0),d=s(1),b=s(10),{isMobile:F}=fe(),k=s([]),g=s(!1),T=s(),v=s(),L=s([]),C=E({name:""}),l=E({id:null,name:"",remark:"",menuIdList:[]}),q=R(()=>l.id?"编辑角色":"新增角色"),A={name:[{required:!0,message:"请输入角色名称",trigger:"blur"}]},B=R(()=>Math.ceil(w.value/b.value)||1),i=()=>{_.value=!0,I("/sys/role/page",{pageNum:d.value,pageSize:b.value,name:C.name}).then(n=>{S.value=n.data.records||[],w.value=Number(n.data.total)||0,_.value=!1}).catch(()=>{_.value=!1})},G=()=>{I("/sys/menu/list").then(n=>{L.value=n.data}).catch(()=>{})},D=()=>{K(()=>{i()})},H=()=>{d.value>1&&(d.value--,i())},O=()=>{d.value<B.value&&(d.value++,i())},J=n=>{d.value=n,i()},P=()=>{d.value=1,i()},Q=()=>{C.name="",P()},W=n=>{k.value=n.map(e=>e.id)},U=()=>{l.id=null,l.name="",l.remark="",l.menuIdList=[]},X=()=>{U(),g.value=!0,K(()=>{v.value?.setCheckedKeys([])})},Y=n=>{U(),I("/sys/role/info",{id:n.id}).then(e=>{Object.assign(l,e.data),g.value=!0,K(()=>{const p=(l.menuIdList||[]).filter(r=>{const c=v.value?.getNode(r);return c&&c.isLeaf});v.value?.setCheckedKeys(p)})}).catch(()=>{})},Z=()=>{T.value.validate().then(()=>{const n=v.value?.getCheckedKeys()||[],e=v.value?.getHalfCheckedKeys()||[];l.menuIdList=[...n,...e],V.value=!0;const p=l.id?"/sys/role/update":"/sys/role/save";N(p,l).then(()=>{z.success(l.id?"修改成功":"新增成功"),g.value=!1,i()}).catch(()=>{}).finally(()=>{V.value=!1})}).catch(()=>{})},ee=n=>{j.confirm("确定要删除该角色吗？","提示",{type:"warning"}).then(()=>{N("/sys/role/delete",[n.id]).then(()=>{z.success("删除成功"),i()}).catch(()=>{})}).catch(()=>{})},ae=()=>{j.confirm(`确定要删除选中的 ${k.value.length} 个角色吗？`,"提示",{type:"warning"}).then(()=>{N("/sys/role/delete",k.value).then(()=>{z.success("删除成功"),i()}).catch(()=>{})}).catch(()=>{})};return ue(()=>{i(),G()}),(n,e)=>{const p=u("el-input"),r=u("el-button"),c=u("el-table-column"),le=u("el-table"),te=u("el-pagination"),M=u("el-form-item"),ne=u("el-tree"),oe=u("el-form"),se=u("el-dialog"),x=$("permission"),de=$("loading");return f(),ce("div",he,[me("div",ye,[a(p,{modelValue:C.name,"onUpdate:modelValue":e[0]||(e[0]=o=>C.name=o),placeholder:"角色名称",clearable:"",class:"search-input",onKeyup:pe(P,["enter"])},null,8,["modelValue"]),a(r,{type:"primary",onClick:P},{default:t(()=>[...e[7]||(e[7]=[m("搜索",-1)])]),_:1}),a(r,{onClick:Q},{default:t(()=>[...e[8]||(e[8]=[m("重置",-1)])]),_:1}),h((f(),y(r,{type:"primary",onClick:X},{default:t(()=>[...e[9]||(e[9]=[m("新增",-1)])]),_:1})),[[x,"role:save"]]),h((f(),y(r,{type:"danger",disabled:!k.value.length,onClick:ae},{default:t(()=>[...e[10]||(e[10]=[m("批量删除",-1)])]),_:1},8,["disabled"])),[[x,"role:delete"]])]),h((f(),y(le,{data:S.value,"element-loading-delay":200,"element-loading-background":"transparent",onSelectionChange:W,class:"data-table"},{default:t(()=>[a(c,{type:"selection",width:"50"}),a(c,{prop:"name",label:"角色名称","min-width":"150"}),a(c,{prop:"remark",label:"备注","min-width":"200"}),a(c,{prop:"createTime",label:"创建时间",width:"170"}),a(c,{label:"操作",width:"150",fixed:ge(F)?!1:"right"},{default:t(({row:o})=>[h((f(),y(r,{link:"",type:"primary",onClick:re=>Y(o)},{default:t(()=>[...e[11]||(e[11]=[m("编辑",-1)])]),_:1},8,["onClick"])),[[x,"role:update"]]),h((f(),y(r,{link:"",type:"danger",onClick:re=>ee(o)},{default:t(()=>[...e[12]||(e[12]=[m("删除",-1)])]),_:1},8,["onClick"])),[[x,"role:delete"]])]),_:1},8,["fixed"])]),_:1},8,["data"])),[[de,_.value]]),a(te,{"current-page":d.value,"onUpdate:currentPage":e[1]||(e[1]=o=>d.value=o),"page-size":b.value,"onUpdate:pageSize":e[2]||(e[2]=o=>b.value=o),total:w.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",class:"pagination",onSizeChange:D,onCurrentChange:D},null,8,["current-page","page-size","total"]),a(ve,{"current-page":d.value,"total-pages":B.value,onPrev:H,onNext:O,onPageChange:J,class:"mobile-pagination"},null,8,["current-page","total-pages"]),a(se,{modelValue:g.value,"onUpdate:modelValue":e[6]||(e[6]=o=>g.value=o),title:q.value,width:"600px","close-on-click-modal":!1},{footer:t(()=>[a(r,{onClick:e[5]||(e[5]=o=>g.value=!1)},{default:t(()=>[...e[13]||(e[13]=[m("取消",-1)])]),_:1}),a(r,{type:"primary",loading:V.value,onClick:Z},{default:t(()=>[...e[14]||(e[14]=[m("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[a(oe,{ref_key:"formRef",ref:T,model:l,rules:A,"label-width":"80px"},{default:t(()=>[a(M,{label:"角色名称",prop:"name"},{default:t(()=>[a(p,{modelValue:l.name,"onUpdate:modelValue":e[3]||(e[3]=o=>l.name=o),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),a(M,{label:"备注",prop:"remark"},{default:t(()=>[a(p,{modelValue:l.remark,"onUpdate:modelValue":e[4]||(e[4]=o=>l.remark=o),type:"textarea",rows:2,placeholder:"请输入备注"},null,8,["modelValue"])]),_:1}),a(M,{label:"菜单权限",prop:"menuIdList"},{default:t(()=>[a(ne,{ref_key:"menuTreeRef",ref:v,data:L.value,props:{label:"name",children:"children"},"node-key":"id","show-checkbox":"","default-expand-all":"",class:"menu-tree"},null,8,["data"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Ve=ie(_e,[["__scopeId","data-v-2fad9531"]]);export{Ve as default};
