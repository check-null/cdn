import{_ as le,r as u,a as te,n as $,o as ae,g as d,V as N,c as ne,b as r,d as oe,P as v,e as t,y as f,w as n,m as i,A as q,i as A,t as L,h,M as R,G as se,p as S,E as I}from"./index-BxFS-j2d.js";import{u as de}from"./useIsMobile-yINUZpTF.js";const ie={class:"page-container"},ue={class:"action-bar"},re={__name:"index",setup(pe){const _=u(!1),V=u(!1),k=u([]),C=u([{id:0,name:"顶级菜单",children:[]}]),p=u(!1),y=u(),{isMobile:w}=de(),g=u(!0),D=u(0),l=te({id:null,pid:"0",name:"",url:"",permissions:"",menuType:0,sort:0}),F=$(()=>l.id?"编辑菜单":"新增菜单");$(()=>[{id:0,name:"顶级菜单",children:k.value}]);const G={name:[{required:!0,message:"请输入名称",trigger:"blur"}],menuType:[{required:!0,message:"请选择类型",trigger:"change"}],pid:[{required:!0,message:"请选择上级菜单",trigger:"change"}]},x=()=>{_.value=!0,h("/sys/menu/list").then(s=>{k.value=s.data||[],_.value=!1}).catch(()=>{_.value=!1})},K=()=>{h("/sys/menu/select-list").then(s=>{C.value=[{id:"0",name:"顶级菜单",children:s.data||[]}]}).catch(()=>{})},P=()=>{g.value=!g.value,D.value++},U=()=>{l.id=null,l.pid="0",l.name="",l.url="",l.permissions="",l.menuType=0,l.sort=0},E=s=>{U(),l.pid=s===0?"0":s,p.value=!0,R(()=>{y.value?.clearValidate()})},j=s=>{U(),h("/sys/menu/info",{id:s.id}).then(e=>{const o=e.data;l.id=o.id,l.pid=o.pid===0?"0":o.pid,l.name=o.name,l.url=o.url||"",l.permissions=o.permissions||"",l.menuType=o.menuType,l.sort=o.sort||0,p.value=!0,R(()=>{y.value?.clearValidate()})}).catch(()=>{})},z=()=>{y.value.validate().then(()=>{V.value=!0;const s=l.id?"/sys/menu/update":"/sys/menu/save",e={...l,pid:l.pid==="0"?0:l.pid};S(s,e).then(()=>{I.success(l.id?"修改成功":"新增成功"),p.value=!1,x()}).catch(()=>{}).finally(()=>{V.value=!1})}).catch(()=>{})},H=s=>{se.confirm("确定要删除该菜单吗？","提示",{type:"warning"}).then(()=>{S("/sys/menu/delete",{id:s.id}).then(()=>{I.success("删除成功"),x()}).catch(()=>{})}).catch(()=>{})};return ae(()=>{x(),K()}),(s,e)=>{const o=d("el-button"),m=d("el-table-column"),J=d("el-tag"),O=d("el-table"),M=d("el-radio"),Q=d("el-radio-group"),c=d("el-form-item"),W=d("el-tree-select"),T=d("el-input"),X=d("el-input-number"),Y=d("el-form"),Z=d("el-dialog"),b=N("permission"),ee=N("loading");return r(),ne("div",ie,[oe("div",ue,[v((r(),f(o,{type:"primary",onClick:e[0]||(e[0]=a=>E(0))},{default:n(()=>[...e[9]||(e[9]=[i("新增",-1)])]),_:1})),[[b,"menu:save"]]),t(o,{onClick:P},{default:n(()=>[i(q(g.value?"全部收起":"全部展开"),1)]),_:1})]),v((r(),f(O,{ref:"tableRef",data:k.value,"element-loading-delay":200,"element-loading-background":"transparent","row-key":"id","tree-props":{children:"children"},"default-expand-all":g.value,key:D.value,class:"data-table"},{default:n(()=>[t(m,{prop:"name",label:"名称","min-width":"180"}),t(m,{prop:"menuType",label:"类型",width:"80"},{default:n(({row:a})=>[t(J,{type:a.menuType===0?null:"warning"},{default:n(()=>[i(q(a.menuType===0?"菜单":"按钮"),1)]),_:2},1032,["type"])]),_:1}),t(m,{prop:"url",label:"路由","min-width":"150"}),t(m,{prop:"permissions",label:"权限标识","min-width":"180"}),t(m,{prop:"sort",label:"排序",width:"80"}),t(m,{label:"操作",width:"200",fixed:A(w)?!1:"right"},{default:n(({row:a})=>[a.menuType===0?v((r(),f(o,{key:0,link:"",type:"primary",onClick:B=>E(a.id)},{default:n(()=>[...e[10]||(e[10]=[i("新增",-1)])]),_:1},8,["onClick"])),[[b,"menu:save"]]):L("",!0),v((r(),f(o,{link:"",type:"primary",onClick:B=>j(a)},{default:n(()=>[...e[11]||(e[11]=[i("编辑",-1)])]),_:1},8,["onClick"])),[[b,"menu:update"]]),v((r(),f(o,{link:"",type:"danger",onClick:B=>H(a)},{default:n(()=>[...e[12]||(e[12]=[i("删除",-1)])]),_:1},8,["onClick"])),[[b,"menu:delete"]])]),_:1},8,["fixed"])]),_:1},8,["data","default-expand-all"])),[[ee,_.value]]),t(Z,{modelValue:p.value,"onUpdate:modelValue":e[8]||(e[8]=a=>p.value=a),title:F.value,width:"550px",fullscreen:A(w),"close-on-click-modal":!1},{footer:n(()=>[t(o,{onClick:e[7]||(e[7]=a=>p.value=!1)},{default:n(()=>[...e[15]||(e[15]=[i("取消",-1)])]),_:1}),t(o,{type:"primary",loading:V.value,onClick:z},{default:n(()=>[...e[16]||(e[16]=[i("确定",-1)])]),_:1},8,["loading"])]),default:n(()=>[t(Y,{ref_key:"formRef",ref:y,model:l,rules:G,"label-width":"100px"},{default:n(()=>[t(c,{label:"类型",prop:"menuType"},{default:n(()=>[t(Q,{modelValue:l.menuType,"onUpdate:modelValue":e[1]||(e[1]=a=>l.menuType=a)},{default:n(()=>[t(M,{value:0},{default:n(()=>[...e[13]||(e[13]=[i("菜单",-1)])]),_:1}),t(M,{value:1},{default:n(()=>[...e[14]||(e[14]=[i("按钮",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"上级菜单",prop:"pid"},{default:n(()=>[t(W,{modelValue:l.pid,"onUpdate:modelValue":e[2]||(e[2]=a=>l.pid=a),data:C.value,props:{label:"name",children:"children",value:"id"},"check-strictly":"","render-after-expand":!1,placeholder:"请选择上级菜单",style:{width:"100%"}},null,8,["modelValue","data"])]),_:1}),t(c,{label:"名称",prop:"name"},{default:n(()=>[t(T,{modelValue:l.name,"onUpdate:modelValue":e[3]||(e[3]=a=>l.name=a),placeholder:"请输入名称"},null,8,["modelValue"])]),_:1}),l.menuType===0?(r(),f(c,{key:0,label:"路由",prop:"url"},{default:n(()=>[t(T,{modelValue:l.url,"onUpdate:modelValue":e[4]||(e[4]=a=>l.url=a),placeholder:"请输入路由地址"},null,8,["modelValue"])]),_:1})):L("",!0),t(c,{label:"权限标识",prop:"permissions"},{default:n(()=>[t(T,{modelValue:l.permissions,"onUpdate:modelValue":e[5]||(e[5]=a=>l.permissions=a),placeholder:"如：sys:user:list,sys:user:save"},null,8,["modelValue"])]),_:1}),t(c,{label:"排序",prop:"sort"},{default:n(()=>[t(X,{modelValue:l.sort,"onUpdate:modelValue":e[6]||(e[6]=a=>l.sort=a),min:0,max:100},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title","fullscreen"])])}}},fe=le(re,[["__scopeId","data-v-de066df3"]]);export{fe as default};
