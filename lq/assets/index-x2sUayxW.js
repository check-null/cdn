import{_ as F,r as p,a as v,o as R,c as E,b as S,d as u,e as o,w as a,g as n,h as q,m,p as V,E as b}from"./index-AzrYMVvE.js";const B={class:"profile-card"},O={class:"profile-content"},J={class:"profile-section"},M={class:"profile-section"},j={__name:"index",setup(T){const c=p(),_=p(),f=p(!1),w=p(!1),l=v({account:"",nickName:"",gender:2,email:"",historyLimit:3}),r=v({oldPassword:"",newPassword:"",confirmPassword:""}),k={email:[{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}]},N={oldPassword:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(i,e,d)=>{e!==r.newPassword?d(new Error("两次输入的密码不一致")):d()},trigger:"blur"}]},U=async()=>{try{const i=await q("/sys/user/profile");Object.assign(l,i.data)}catch{}},x=async()=>{if(await c.value.validate().catch(()=>!1)){f.value=!0;try{await V("/sys/user/updateProfile",{nickName:l.nickName,gender:l.gender,email:l.email,historyLimit:l.historyLimit});const e=JSON.parse(localStorage.getItem("userInfo")||"{}");e.nickName=l.nickName,e.historyLimit=l.historyLimit,localStorage.setItem("userInfo",JSON.stringify(e)),b.success("保存成功")}finally{f.value=!1}}},L=async()=>{if(await _.value.validate().catch(()=>!1)){w.value=!0;try{await V("/sys/user/updatePassword",{oldPassword:r.oldPassword,newPassword:r.newPassword}),b.success("密码修改成功"),r.oldPassword="",r.newPassword="",r.confirmPassword=""}finally{w.value=!1}}};return R(()=>{U()}),(i,e)=>{const d=n("el-input"),t=n("el-form-item"),g=n("el-radio"),I=n("el-radio-group"),C=n("el-input-number"),y=n("el-button"),P=n("el-form");return S(),E("div",B,[u("div",O,[u("div",J,[e[13]||(e[13]=u("h3",null,"个人信息",-1)),o(P,{ref_key:"infoFormRef",ref:c,model:l,rules:k,"label-width":"100px"},{default:a(()=>[o(t,{label:"账号"},{default:a(()=>[o(d,{modelValue:l.account,"onUpdate:modelValue":e[0]||(e[0]=s=>l.account=s),disabled:""},null,8,["modelValue"])]),_:1}),o(t,{label:"昵称",prop:"nickName"},{default:a(()=>[o(d,{modelValue:l.nickName,"onUpdate:modelValue":e[1]||(e[1]=s=>l.nickName=s),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),o(t,{label:"性别",prop:"gender"},{default:a(()=>[o(I,{modelValue:l.gender,"onUpdate:modelValue":e[2]||(e[2]=s=>l.gender=s)},{default:a(()=>[o(g,{value:0},{default:a(()=>[...e[8]||(e[8]=[m("男",-1)])]),_:1}),o(g,{value:1},{default:a(()=>[...e[9]||(e[9]=[m("女",-1)])]),_:1}),o(g,{value:2},{default:a(()=>[...e[10]||(e[10]=[m("保密",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(t,{label:"邮箱",prop:"email"},{default:a(()=>[o(d,{modelValue:l.email,"onUpdate:modelValue":e[3]||(e[3]=s=>l.email=s),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),o(t,{label:"历史记录数",prop:"historyLimit"},{default:a(()=>[o(C,{modelValue:l.historyLimit,"onUpdate:modelValue":e[4]||(e[4]=s=>l.historyLimit=s),min:1,max:20},null,8,["modelValue"]),e[11]||(e[11]=u("span",{class:"form-tip"},"首页抽题时保留的历史记录数量",-1))]),_:1}),o(t,null,{default:a(()=>[o(y,{type:"primary",loading:f.value,onClick:x},{default:a(()=>[...e[12]||(e[12]=[m("保存信息",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),u("div",M,[e[15]||(e[15]=u("h3",null,"修改密码",-1)),o(P,{ref_key:"pwdFormRef",ref:_,model:r,rules:N,"label-width":"100px"},{default:a(()=>[o(t,{label:"原密码",prop:"oldPassword"},{default:a(()=>[o(d,{modelValue:r.oldPassword,"onUpdate:modelValue":e[5]||(e[5]=s=>r.oldPassword=s),type:"password",placeholder:"请输入原密码","show-password":""},null,8,["modelValue"])]),_:1}),o(t,{label:"新密码",prop:"newPassword"},{default:a(()=>[o(d,{modelValue:r.newPassword,"onUpdate:modelValue":e[6]||(e[6]=s=>r.newPassword=s),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),o(t,{label:"确认密码",prop:"confirmPassword"},{default:a(()=>[o(d,{modelValue:r.confirmPassword,"onUpdate:modelValue":e[7]||(e[7]=s=>r.confirmPassword=s),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),o(t,null,{default:a(()=>[o(y,{type:"primary",loading:w.value,onClick:L},{default:a(()=>[...e[14]||(e[14]=[m("修改密码",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])])])}}},A=F(j,[["__scopeId","data-v-78e05b25"]]);export{A as default};
