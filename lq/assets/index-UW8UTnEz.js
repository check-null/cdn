import{_ as ae,r as u,n as ce,I as ie,o as re,h as B,c as y,b as i,d as l,e as s,y as p,t as x,w as n,g as T,v as Q,A as f,i as g,J as de,L as H,F as ue,x as ve,p as E,M as F,N as J,O as he,P as fe,m as k,z as O,Q as $,R as j,S as _e,T as ge}from"./index-TA7qbyPo.js";import{V as ye}from"./index-DxNKuDiC.js";import{g as pe}from"./icons-Dv9EfjIj.js";const me={class:"home-container"},ke={class:"mobile-category mobile-only"},Ce={class:"section-title"},be={class:"mobile-tree-wrapper"},we={class:"tree-actions"},Ke={class:"tree-node"},xe={class:"node-label"},Te={key:3,class:"node-count"},Ne={class:"pc-layout"},qe={key:0,class:"question-card"},ze={class:"card-header"},Ie={class:"question-index"},Le={class:"question-title"},Re={key:0,class:"glass-mask"},Se={class:"reveal-hint"},Me={key:1,class:"empty-card"},Ve={class:"bottom-bar"},Ae={key:2,class:"history-dots"},Be=["onClick","title"],Qe={class:"category-section pc-category"},De={class:"category-card"},He={class:"section-title"},Ee={key:0,class:"selected-count"},Fe={class:"tree-actions"},Je={class:"tree-node"},Oe={class:"node-label"},$e={key:3,class:"node-count"},je={__name:"index",setup(Pe){const I=e=>pe(e),C=u([]),d=u([]),m=u([]),_=u([]),v=u(-1),b=u(!1),L=u(!1),M=u(null),V=u(null),N=u(null),q=u(null),z=u(!1),P=u((()=>{const e=localStorage.getItem("userInfo");return e&&JSON.parse(e).historyLimit||3})()),w=ce(()=>v.value>=0&&v.value<_.value.length?_.value[v.value]:null);ie(w,async()=>{await F(),M.value&&w.value?.content&&ye.preview(M.value,w.value.content,{mode:"light",theme:{current:"wechat",path:"/node_modules/vditor/dist/css/content-theme"},hljs:{lineNumber:!0},cdn:"/vditor"})});const G=()=>{B("/category/tree").then(e=>{C.value=e.data||[]}).catch(()=>{})},U=()=>{const e=N.value?.getCheckedKeys()||[];m.value=e.filter(t=>{const c=a=>{for(const h of a){if(h.id===t)return h;if(h.children){const K=c(h.children);if(K)return K}}return null},r=c(C.value);return r&&(!r.children||r.children.length===0)})},W=()=>{d.value=[...m.value],E("/question/save-categories",d.value).catch(()=>{})},X=()=>{if(m.value.length===0){const e=c=>{let r=[];for(const a of c)!a.children||a.children.length===0?r.push(a.id):r=r.concat(e(a.children));return r},t=e(C.value);m.value=t,N.value?.setCheckedKeys(t)}else m.value=[],N.value?.setCheckedKeys([])},Y=()=>{if(d.value.length===0){const e=c=>{let r=[];for(const a of c)!a.children||a.children.length===0?r.push(a.id):r=r.concat(e(a.children));return r},t=e(C.value);d.value=t,q.value?.setCheckedKeys(t)}else d.value=[],q.value?.setCheckedKeys([])},Z=()=>{const e=q.value?.getCheckedKeys()||[];d.value=e.filter(t=>{const c=a=>{for(const h of a){if(h.id===t)return h;if(h.children){const K=c(h.children);if(K)return K}}return null},r=c(C.value);return r&&(!r.children||r.children.length===0)})},D=()=>{z.value=!z.value,z.value||E("/question/save-categories",d.value).catch(()=>{})},ee=()=>{b.value=!0},R=()=>{F(()=>{V.value&&V.value.scrollIntoView({behavior:"smooth",block:"start"}),window.scrollTo({behavior:"smooth",top:0})})},te=()=>{if(v.value<_.value.length-1){v.value=_.value.length-1,b.value=!1,R();return}A()},A=()=>{L.value=!0;const e={};d.value.length>0&&(e.categoryIds=d.value),B("/question/random",e).then(t=>{t.data&&(_.value.push(t.data),_.value.length>P.value&&_.value.shift(),v.value=_.value.length-1,b.value=!1,R())}).catch(()=>{}).finally(()=>{L.value=!1})},le=()=>{v.value>0&&(v.value--,b.value=!1,R())},se=e=>{v.value=e,b.value=!1,R()};return re(()=>{G(),B("/question/get-categories").then(e=>{e.data&&e.data.length>0&&(d.value=e.data,m.value=e.data,N.value?.setCheckedKeys(e.data),q.value?.setCheckedKeys(e.data))}).catch(()=>{}),A()}),(e,t)=>{const c=T("el-icon"),r=T("el-badge"),a=T("el-button"),h=T("el-tree"),K=T("el-collapse-transition"),oe=T("el-tag"),ne=T("el-empty");return i(),y("div",me,[l("div",ke,[l("div",{class:"mobile-category-header",onClick:D},[l("div",Ce,[s(c,null,{default:n(()=>[s(g(J))]),_:1}),t[0]||(t[0]=l("span",null,"选择分类（可多选）",-1)),d.value.length>0?(i(),p(r,{key:0,value:d.value.length,class:"category-badge"},null,8,["value"])):x("",!0)]),s(c,{class:Q(["toggle-icon",{expanded:z.value}])},{default:n(()=>[s(g(he))]),_:1},8,["class"])]),s(K,null,{default:n(()=>[fe(l("div",be,[l("div",we,[s(a,{size:"small",onClick:Y},{default:n(()=>[k(f(d.value.length===0?"全选":"清空"),1)]),_:1}),s(a,{size:"small",type:"primary",onClick:D},{default:n(()=>[...t[1]||(t[1]=[k(" 确定 ",-1)])]),_:1})]),s(h,{ref_key:"mobileTreeRef",ref:q,data:C.value,props:{label:"categoryName",children:"children"},"node-key":"id","show-checkbox":"","default-checked-keys":d.value,onCheck:Z,class:"category-tree","default-expand-all":!0},{default:n(({node:S,data:o})=>[l("span",Ke,[o.icon&&I(o.icon)?(i(),p(c,{key:0},{default:n(()=>[(i(),p(O(I(o.icon))))]),_:2},1024)):o.children&&o.children.length>0?(i(),p(c,{key:1},{default:n(()=>[s(g($))]),_:1})):(i(),p(c,{key:2},{default:n(()=>[s(g(j))]),_:1})),l("span",xe,f(S.label),1),!o.children||o.children.length===0?(i(),y("span",Te," ("+f(o.weight||0)+") ",1)):x("",!0)])]),_:1},8,["data","default-checked-keys"])],512),[[_e,z.value]])]),_:1})]),l("div",Ne,[l("div",{class:"question-section",ref_key:"questionSectionRef",ref:V},[w.value?(i(),y("div",qe,[l("div",ze,[s(oe,{size:"large",type:"primary"},{default:n(()=>[k(f(w.value.categoryName||"未分类"),1)]),_:1}),l("span",Ie,f(v.value+1)+" / "+f(_.value.length),1)]),l("h1",Le,f(w.value.title),1),l("div",{class:Q(["answer-wrapper",{revealed:b.value}]),onClick:ee},[l("div",{class:"answer-content",ref_key:"answerRef",ref:M},null,512),b.value?x("",!0):(i(),y("div",Re,[l("div",Se,[s(c,{size:36},{default:n(()=>[s(g(ge))]),_:1}),t[2]||(t[2]=l("span",null,"点击查看答案",-1))])]))],2)])):(i(),y("div",Me,[s(ne,{description:"暂无题目"},{default:n(()=>[s(a,{type:"primary",icon:g(H),loading:L.value,onClick:A},{default:n(()=>[...t[3]||(t[3]=[k(" 开始抽题 ",-1)])]),_:1},8,["icon","loading"])]),_:1})])),l("div",Ve,[v.value>0?(i(),p(a,{key:0,size:"large",icon:g(de),onClick:le},{default:n(()=>[...t[4]||(t[4]=[k(" 上一题 ",-1)])]),_:1},8,["icon"])):x("",!0),s(a,{type:"primary",size:"large",icon:g(H),loading:L.value,onClick:te},{default:n(()=>[k(f(w.value?"下一题":"开始抽题"),1)]),_:1},8,["icon","loading"])]),_.value.length>1?(i(),y("div",Ae,[(i(!0),y(ue,null,ve(_.value,(S,o)=>(i(),y("span",{key:o,class:Q(["dot",{active:o===v.value}]),onClick:We=>se(o),title:`第 ${o+1} 题`},null,10,Be))),128))])):x("",!0)],512),l("div",Qe,[l("div",De,[l("div",He,[s(c,null,{default:n(()=>[s(g(J))]),_:1}),t[5]||(t[5]=l("span",null,"题目分类（多选）",-1))]),d.value.length>0?(i(),y("div",Ee," 已选 "+f(d.value.length)+" 个分类 ",1)):x("",!0),l("div",Fe,[s(a,{size:"small",onClick:X},{default:n(()=>[k(f(m.value.length===0?"全选":"清空"),1)]),_:1}),s(a,{size:"small",type:"primary",onClick:W},{default:n(()=>[...t[6]||(t[6]=[k(" 确定 ",-1)])]),_:1})]),s(h,{ref_key:"categoryTreeRef",ref:N,data:C.value,props:{label:"categoryName",children:"children"},"node-key":"id","show-checkbox":"","default-checked-keys":m.value,onCheck:U,class:"category-tree","default-expand-all":!0},{default:n(({node:S,data:o})=>[l("span",Je,[o.icon&&I(o.icon)?(i(),p(c,{key:0},{default:n(()=>[(i(),p(O(I(o.icon))))]),_:2},1024)):o.children&&o.children.length>0?(i(),p(c,{key:1},{default:n(()=>[s(g($))]),_:1})):(i(),p(c,{key:2},{default:n(()=>[s(g(j))]),_:1})),l("span",Oe,f(S.label),1),!o.children||o.children.length===0?(i(),y("span",$e," ("+f(o.weight||0)+") ",1)):x("",!0)])]),_:1},8,["data","default-checked-keys"])])])])])}}},et=ae(je,[["__scopeId","data-v-8dfd08ce"]]);export{et as default};
