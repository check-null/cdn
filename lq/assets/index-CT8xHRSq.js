import{_ as x,r as n,a as V,o as b,c as I,b as N,d as r,e as t,w as s,f as z,g as i,h as C,u as S,i as m,j as U,l as K,k as L,m as q,p as B,E}from"./index-DHR2gzNo.js";const R={class:"login-container"},J={class:"login-card"},M={class:"captcha-row"},O=["src"],j={__name:"index",setup(Q){const y=S(),f=n(),u=n(!1),g=n(""),_=n(""),a=V({account:"",password:"",captcha:""}),v={account:[{required:!0,message:"请输入账号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],captcha:[{required:!0,message:"请输入验证码",trigger:"blur"}]},d=async()=>{try{const o=await C("/sys/auth/captcha");g.value=o.data.image,_.value=o.data.key}catch{}},h=async()=>{if(await f.value.validate().catch(()=>!1)){u.value=!0;try{const e=await B("/sys/auth/login",{account:a.account,password:a.password,captcha:a.captcha,captchaKey:_.value});localStorage.setItem("token",e.data.token),localStorage.setItem("userInfo",JSON.stringify({userId:e.data.userId,account:e.data.account,nickName:e.data.nickName,headUrl:e.data.headUrl,historyLimit:e.data.historyLimit||3})),localStorage.setItem("permissions",JSON.stringify(e.data.permissions||[])),E.success("登录成功"),y.push("/")}catch{d()}finally{u.value=!1}}};return b(()=>{d()}),(o,e)=>{const p=i("el-input"),c=i("el-form-item"),w=i("el-button"),k=i("el-form");return N(),I("div",R,[r("div",J,[e[4]||(e[4]=r("h2",{class:"title"},"LightQuiz",-1)),e[5]||(e[5]=r("p",{class:"subtitle"},"面试八股文",-1)),t(k,{ref_key:"formRef",ref:f,model:a,rules:v,onKeyup:z(h,["enter"])},{default:s(()=>[t(c,{prop:"account"},{default:s(()=>[t(p,{modelValue:a.account,"onUpdate:modelValue":e[0]||(e[0]=l=>a.account=l),placeholder:"账号","prefix-icon":m(U),size:"large"},null,8,["modelValue","prefix-icon"])]),_:1}),t(c,{prop:"password"},{default:s(()=>[t(p,{modelValue:a.password,"onUpdate:modelValue":e[1]||(e[1]=l=>a.password=l),type:"password",placeholder:"密码","prefix-icon":m(K),size:"large","show-password":""},null,8,["modelValue","prefix-icon"])]),_:1}),t(c,{prop:"captcha"},{default:s(()=>[r("div",M,[t(p,{modelValue:a.captcha,"onUpdate:modelValue":e[2]||(e[2]=l=>a.captcha=l),placeholder:"验证码","prefix-icon":m(L),size:"large",class:"captcha-input"},null,8,["modelValue","prefix-icon"]),r("img",{src:g.value,class:"captcha-img",onClick:d,alt:"验证码",title:"点击刷新"},null,8,O)])]),_:1}),t(c,null,{default:s(()=>[t(w,{type:"primary",size:"large",loading:u.value,class:"login-btn",onClick:h},{default:s(()=>[...e[3]||(e[3]=[q(" 登 录 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])])}}},A=x(j,[["__scopeId","data-v-b42fdf60"]]);export{A as default};
