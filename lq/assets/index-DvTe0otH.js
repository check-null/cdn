import{_ as ee,r as u,a as le,n as B,o as te,g as d,V as $,c as ae,b as r,d as ne,P as v,e as t,y as f,w as n,m as i,A as N,i as oe,t as q,h,M as A,G as se,p as L,E as R}from"./index-BMQRMbXv.js";import{u as de}from"./useIsMobile-DxgdRbS5.js";const ie={class:"page-container"},ue={class:"action-bar"},re={__name:"index",setup(pe){const _=u(!1),V=u(!1),k=u([]),C=u([{id:0,name:"顶级菜单",children:[]}]),p=u(!1),y=u(),{isMobile:S}=de(),g=u(!0),w=u(0),l=le({id:null,pid:"0",name:"",url:"",permissions:"",menuType:0,sort:0}),I=B(()=>l.id?"编辑菜单":"新增菜单");B(()=>[{id:0,name:"顶级菜单",children:k.value}]);const F={name:[{required:!0,message:"请输入名称",trigger:"blur"}],menuType:[{required:!0,message:"请选择类型",trigger:"change"}],pid:[{required:!0,message:"请选择上级菜单",trigger:"change"}]},x=()=>{_.value=!0,h("/sys/menu/list").then(s=>{k.value=s.data||[],_.value=!1}).catch(()=>{_.value=!1})},G=()=>{h("/sys/menu/select-list").then(s=>{C.value=[{id:"0",name:"顶级菜单",children:s.data||[]}]}).catch(()=>{})},K=()=>{g.value=!g.value,w.value++},D=()=>{l.id=null,l.pid="0",l.name="",l.url="",l.permissions="",l.menuType=0,l.sort=0},U=s=>{D(),l.pid=s===0?"0":s,p.value=!0,A(()=>{y.value?.clearValidate()})},P=s=>{D(),h("/sys/menu/info",{id:s.id}).then(e=>{const o=e.data;l.id=o.id,l.pid=o.pid===0?"0":o.pid,l.name=o.name,l.url=o.url||"",l.permissions=o.permissions||"",l.menuType=o.menuType,l.sort=o.sort||0,p.value=!0,A(()=>{y.value?.clearValidate()})}).catch(()=>{})},j=()=>{y.value.validate().then(()=>{V.value=!0;const s=l.id?"/sys/menu/update":"/sys/menu/save",e={...l,pid:l.pid==="0"?0:l.pid};L(s,e).then(()=>{R.success(l.id?"修改成功":"新增成功"),p.value=!1,x()}).catch(()=>{}).finally(()=>{V.value=!1})}).catch(()=>{})},z=s=>{se.confirm("确定要删除该菜单吗？","提示",{type:"warning"}).then(()=>{L("/sys/menu/delete",{id:s.id}).then(()=>{R.success("删除成功"),x()}).catch(()=>{})}).catch(()=>{})};return te(()=>{x(),G()}),(s,e)=>{const o=d("el-button"),m=d("el-table-column"),H=d("el-tag"),J=d("el-table"),E=d("el-radio"),O=d("el-radio-group"),c=d("el-form-item"),Q=d("el-tree-select"),T=d("el-input"),W=d("el-input-number"),X=d("el-form"),Y=d("el-dialog"),b=$("permission"),Z=$("loading");return r(),ae("div",ie,[ne("div",ue,[v((r(),f(o,{type:"primary",onClick:e[0]||(e[0]=a=>U(0))},{default:n(()=>[...e[9]||(e[9]=[i("新增",-1)])]),_:1})),[[b,"menu:save"]]),t(o,{onClick:K},{default:n(()=>[i(N(g.value?"全部收起":"全部展开"),1)]),_:1})]),v((r(),f(J,{ref:"tableRef",data:k.value,"element-loading-delay":200,"element-loading-background":"transparent","row-key":"id","tree-props":{children:"children"},"default-expand-all":g.value,key:w.value,class:"data-table"},{default:n(()=>[t(m,{prop:"name",label:"名称","min-width":"180"}),t(m,{prop:"menuType",label:"类型",width:"80"},{default:n(({row:a})=>[t(H,{type:a.menuType===0?null:"warning"},{default:n(()=>[i(N(a.menuType===0?"菜单":"按钮"),1)]),_:2},1032,["type"])]),_:1}),t(m,{prop:"url",label:"路由","min-width":"150"}),t(m,{prop:"permissions",label:"权限标识","min-width":"180"}),t(m,{prop:"sort",label:"排序",width:"80"}),t(m,{label:"操作",width:"200",fixed:oe(S)?!1:"right"},{default:n(({row:a})=>[a.menuType===0?v((r(),f(o,{key:0,link:"",type:"primary",onClick:M=>U(a.id)},{default:n(()=>[...e[10]||(e[10]=[i("新增",-1)])]),_:1},8,["onClick"])),[[b,"menu:save"]]):q("",!0),v((r(),f(o,{link:"",type:"primary",onClick:M=>P(a)},{default:n(()=>[...e[11]||(e[11]=[i("编辑",-1)])]),_:1},8,["onClick"])),[[b,"menu:update"]]),v((r(),f(o,{link:"",type:"danger",onClick:M=>z(a)},{default:n(()=>[...e[12]||(e[12]=[i("删除",-1)])]),_:1},8,["onClick"])),[[b,"menu:delete"]])]),_:1},8,["fixed"])]),_:1},8,["data","default-expand-all"])),[[Z,_.value]]),t(Y,{modelValue:p.value,"onUpdate:modelValue":e[8]||(e[8]=a=>p.value=a),title:I.value,width:"550px","close-on-click-modal":!1},{footer:n(()=>[t(o,{onClick:e[7]||(e[7]=a=>p.value=!1)},{default:n(()=>[...e[15]||(e[15]=[i("取消",-1)])]),_:1}),t(o,{type:"primary",loading:V.value,onClick:j},{default:n(()=>[...e[16]||(e[16]=[i("确定",-1)])]),_:1},8,["loading"])]),default:n(()=>[t(X,{ref_key:"formRef",ref:y,model:l,rules:F,"label-width":"100px"},{default:n(()=>[t(c,{label:"类型",prop:"menuType"},{default:n(()=>[t(O,{modelValue:l.menuType,"onUpdate:modelValue":e[1]||(e[1]=a=>l.menuType=a)},{default:n(()=>[t(E,{value:0},{default:n(()=>[...e[13]||(e[13]=[i("菜单",-1)])]),_:1}),t(E,{value:1},{default:n(()=>[...e[14]||(e[14]=[i("按钮",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"上级菜单",prop:"pid"},{default:n(()=>[t(Q,{modelValue:l.pid,"onUpdate:modelValue":e[2]||(e[2]=a=>l.pid=a),data:C.value,props:{label:"name",children:"children",value:"id"},"check-strictly":"","render-after-expand":!1,placeholder:"请选择上级菜单",style:{width:"100%"}},null,8,["modelValue","data"])]),_:1}),t(c,{label:"名称",prop:"name"},{default:n(()=>[t(T,{modelValue:l.name,"onUpdate:modelValue":e[3]||(e[3]=a=>l.name=a),placeholder:"请输入名称"},null,8,["modelValue"])]),_:1}),l.menuType===0?(r(),f(c,{key:0,label:"路由",prop:"url"},{default:n(()=>[t(T,{modelValue:l.url,"onUpdate:modelValue":e[4]||(e[4]=a=>l.url=a),placeholder:"请输入路由地址"},null,8,["modelValue"])]),_:1})):q("",!0),t(c,{label:"权限标识",prop:"permissions"},{default:n(()=>[t(T,{modelValue:l.permissions,"onUpdate:modelValue":e[5]||(e[5]=a=>l.permissions=a),placeholder:"如：sys:user:list,sys:user:save"},null,8,["modelValue"])]),_:1}),t(c,{label:"排序",prop:"sort"},{default:n(()=>[t(W,{modelValue:l.sort,"onUpdate:modelValue":e[6]||(e[6]=a=>l.sort=a),min:0,max:100},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},fe=ee(re,[["__scopeId","data-v-c80820fb"]]);export{fe as default};
