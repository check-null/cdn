import{_ as ue,r as s,a as R,n as $,o as ce,g as u,V as j,c as me,b as v,d as pe,P as h,e as a,f as ge,w as t,m,y,i as F,h as I,M as K,G as q,p as N,E as z}from"./index-BxFS-j2d.js";import{M as fe}from"./MobilePagination-J8ddhRyS.js";import{u as ve}from"./useIsMobile-yINUZpTF.js";const he={class:"page-container"},ye={class:"search-bar"},_e={__name:"index",setup(be){const _=s(!1),V=s(!1),S=s([]),w=s(0),r=s(1),b=s(10),{isMobile:T}=ve(),k=s([]),g=s(!1),L=s(),f=s(),B=s([]),C=R({name:""}),l=R({id:null,name:"",remark:"",menuIdList:[]}),A=$(()=>l.id?"编辑角色":"新增角色"),G={name:[{required:!0,message:"请输入角色名称",trigger:"blur"}]},D=$(()=>Math.ceil(w.value/b.value)||1),i=()=>{_.value=!0,I("/sys/role/page",{pageNum:r.value,pageSize:b.value,name:C.name}).then(n=>{S.value=n.data.records||[],w.value=Number(n.data.total)||0,_.value=!1}).catch(()=>{_.value=!1})},H=()=>{I("/sys/menu/list").then(n=>{B.value=n.data}).catch(()=>{})},U=()=>{K(()=>{i()})},O=()=>{r.value>1&&(r.value--,i())},J=()=>{r.value<D.value&&(r.value++,i())},Q=n=>{r.value=n,i()},P=()=>{r.value=1,i()},W=()=>{C.name="",P()},X=n=>{k.value=n.map(e=>e.id)},E=()=>{l.id=null,l.name="",l.remark="",l.menuIdList=[]},Y=()=>{E(),g.value=!0,K(()=>{f.value?.setCheckedKeys([])})},Z=n=>{E(),I("/sys/role/info",{id:n.id}).then(e=>{Object.assign(l,e.data),g.value=!0,K(()=>{const p=(l.menuIdList||[]).filter(d=>{const c=f.value?.getNode(d);return c&&c.isLeaf});f.value?.setCheckedKeys(p)})}).catch(()=>{})},ee=()=>{L.value.validate().then(()=>{const n=f.value?.getCheckedKeys()||[],e=f.value?.getHalfCheckedKeys()||[];l.menuIdList=[...n,...e],V.value=!0;const p=l.id?"/sys/role/update":"/sys/role/save";N(p,l).then(()=>{z.success(l.id?"修改成功":"新增成功"),g.value=!1,i()}).catch(()=>{}).finally(()=>{V.value=!1})}).catch(()=>{})},ae=n=>{q.confirm("确定要删除该角色吗？","提示",{type:"warning"}).then(()=>{N("/sys/role/delete",[n.id]).then(()=>{z.success("删除成功"),i()}).catch(()=>{})}).catch(()=>{})},le=()=>{q.confirm(`确定要删除选中的 ${k.value.length} 个角色吗？`,"提示",{type:"warning"}).then(()=>{N("/sys/role/delete",k.value).then(()=>{z.success("删除成功"),i()}).catch(()=>{})}).catch(()=>{})};return ce(()=>{i(),H()}),(n,e)=>{const p=u("el-input"),d=u("el-button"),c=u("el-table-column"),te=u("el-table"),ne=u("el-pagination"),M=u("el-form-item"),oe=u("el-tree"),se=u("el-form"),re=u("el-dialog"),x=j("permission"),de=j("loading");return v(),me("div",he,[pe("div",ye,[a(p,{modelValue:C.name,"onUpdate:modelValue":e[0]||(e[0]=o=>C.name=o),placeholder:"角色名称",clearable:"",class:"search-input",onKeyup:ge(P,["enter"])},null,8,["modelValue"]),a(d,{type:"primary",onClick:P},{default:t(()=>[...e[7]||(e[7]=[m("搜索",-1)])]),_:1}),a(d,{onClick:W},{default:t(()=>[...e[8]||(e[8]=[m("重置",-1)])]),_:1}),h((v(),y(d,{type:"primary",onClick:Y},{default:t(()=>[...e[9]||(e[9]=[m("新增",-1)])]),_:1})),[[x,"role:save"]]),h((v(),y(d,{type:"danger",disabled:!k.value.length,onClick:le},{default:t(()=>[...e[10]||(e[10]=[m("批量删除",-1)])]),_:1},8,["disabled"])),[[x,"role:delete"]])]),h((v(),y(te,{data:S.value,"element-loading-delay":200,"element-loading-background":"transparent",onSelectionChange:X,class:"data-table"},{default:t(()=>[a(c,{type:"selection",width:"50"}),a(c,{prop:"name",label:"角色名称","min-width":"150"}),a(c,{prop:"remark",label:"备注","min-width":"200"}),a(c,{prop:"createTime",label:"创建时间",width:"170"}),a(c,{label:"操作",width:"150",fixed:F(T)?!1:"right"},{default:t(({row:o})=>[h((v(),y(d,{link:"",type:"primary",onClick:ie=>Z(o)},{default:t(()=>[...e[11]||(e[11]=[m("编辑",-1)])]),_:1},8,["onClick"])),[[x,"role:update"]]),h((v(),y(d,{link:"",type:"danger",onClick:ie=>ae(o)},{default:t(()=>[...e[12]||(e[12]=[m("删除",-1)])]),_:1},8,["onClick"])),[[x,"role:delete"]])]),_:1},8,["fixed"])]),_:1},8,["data"])),[[de,_.value]]),a(ne,{"current-page":r.value,"onUpdate:currentPage":e[1]||(e[1]=o=>r.value=o),"page-size":b.value,"onUpdate:pageSize":e[2]||(e[2]=o=>b.value=o),total:w.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",class:"pagination",onSizeChange:U,onCurrentChange:U},null,8,["current-page","page-size","total"]),a(fe,{"current-page":r.value,"total-pages":D.value,onPrev:O,onNext:J,onPageChange:Q,class:"mobile-pagination"},null,8,["current-page","total-pages"]),a(re,{modelValue:g.value,"onUpdate:modelValue":e[6]||(e[6]=o=>g.value=o),title:A.value,width:"600px",fullscreen:F(T),"close-on-click-modal":!1},{footer:t(()=>[a(d,{onClick:e[5]||(e[5]=o=>g.value=!1)},{default:t(()=>[...e[13]||(e[13]=[m("取消",-1)])]),_:1}),a(d,{type:"primary",loading:V.value,onClick:ee},{default:t(()=>[...e[14]||(e[14]=[m("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[a(se,{ref_key:"formRef",ref:L,model:l,rules:G,"label-width":"80px"},{default:t(()=>[a(M,{label:"角色名称",prop:"name"},{default:t(()=>[a(p,{modelValue:l.name,"onUpdate:modelValue":e[3]||(e[3]=o=>l.name=o),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),a(M,{label:"备注",prop:"remark"},{default:t(()=>[a(p,{modelValue:l.remark,"onUpdate:modelValue":e[4]||(e[4]=o=>l.remark=o),type:"textarea",rows:2,placeholder:"请输入备注"},null,8,["modelValue"])]),_:1}),a(M,{label:"菜单权限",prop:"menuIdList"},{default:t(()=>[a(oe,{ref_key:"menuTreeRef",ref:f,data:B.value,props:{label:"name",children:"children"},"node-key":"id","show-checkbox":"","default-expand-all":"",class:"menu-tree"},null,8,["data"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title","fullscreen"])])}}},Ve=ue(_e,[["__scopeId","data-v-cce8c53e"]]);export{Ve as default};
