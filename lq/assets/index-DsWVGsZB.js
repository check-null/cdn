import{_ as me,r as i,a as F,n as K,o as ve,g as u,V as L,c as fe,b as h,d as A,P as b,e as t,f as he,w as n,m as g,y as _,i as G,h as S,G as O,p as D,E as I,M as H}from"./index-Cea6w0l7.js";import{V as ye}from"./index-Czw8vfOK.js";import{M as be}from"./MobilePagination-Cot_Nq4I.js";import{u as _e}from"./useIsMobile-BY1cz0YX.js";const Ve={class:"page-container"},ke={class:"search-bar"},Ce={__name:"index",setup(we){const V=i(!1),q=i(!1),U=i([]),N=i(0),r=i(1),k=i(10),{isMobile:B}=_e(),C=i([]),v=i(!1),E=i(),J=i([]),P=i([]);let c=null;const p=F({title:"",categoryId:null}),a=F({id:null,title:"",content:"",categoryId:null}),Q=K(()=>a.id?"编辑题目":"新增题目"),W={title:[{required:!0,message:"请输入标题",trigger:"blur"}],categoryId:[{required:!0,message:"请选择分类",trigger:"change"}]},T=K(()=>Math.ceil(N.value/k.value)||1),d=()=>{V.value=!0,S("/question/page",{pageNum:r.value,pageSize:k.value,title:p.title,categoryId:p.categoryId}).then(l=>{U.value=l.data.records||[],N.value=Number(l.data.total)||0,V.value=!1}).catch(()=>{V.value=!1})},X=()=>{S("/category/tree").then(l=>{P.value=l.data||[];const e=w=>{const y=[],s=m=>{m.forEach(f=>{!f.children||f.children.length===0?y.push(f):s(f.children)})};return s(w),y};J.value=e(l.data||[])}).catch(()=>{})},$=()=>{H(()=>{d()})},Y=()=>{r.value>1&&(r.value--,d())},Z=()=>{r.value<T.value&&(r.value++,d())},ee=l=>{r.value=l,d()},M=()=>{r.value=1,d()},te=()=>{p.title="",p.categoryId=null,M()},le=l=>{C.value=l.map(e=>e.id)},R=()=>{a.id=null,a.title="",a.content="",a.categoryId=null},j=(l="")=>{H(()=>{c&&c.destroy(),c=new ye("vditor",{height:"50vh",width:"100%",mode:"ir",placeholder:"请输入内容(支持Markdown)",cache:{enable:!1},cdn:"https://unpkg.com/vditor@3.10.8",after:()=>{c.setValue(l)}})})},ae=()=>{R(),v.value=!0,j("")},oe=l=>{R(),S("/question/info",{id:l.id}).then(e=>{Object.assign(a,e.data),v.value=!0,j(a.content||"")}).catch(()=>{})},ne=()=>{E.value.validate().then(()=>{if(a.content=c?.getValue()||"",!a.content.trim()){I.warning("请输入内容");return}q.value=!0;const l=a.id?"/question/update":"/question/save";D(l,a).then(()=>{I.success(a.id?"修改成功":"新增成功"),v.value=!1,d()}).catch(()=>{}).finally(()=>{q.value=!1})}).catch(()=>{})},se=l=>{O.confirm("确定要删除该题目吗？","提示",{type:"warning"}).then(()=>{D("/question/delete",[l.id]).then(()=>{I.success("删除成功"),d()}).catch(()=>{})}).catch(()=>{})},ie=()=>{O.confirm(`确定要删除选中的 ${C.value.length} 个题目吗？`,"提示",{type:"warning"}).then(()=>{D("/question/delete",C.value).then(()=>{I.success("删除成功"),d()}).catch(()=>{})}).catch(()=>{})},re=()=>{c&&(c.destroy(),c=null)};return ve(()=>{d(),X()}),(l,e)=>{const w=u("el-input"),y=u("el-tree-select"),s=u("el-button"),m=u("el-table-column"),f=u("el-table"),de=u("el-pagination"),z=u("el-form-item"),ue=u("el-form"),ce=u("el-dialog"),x=L("permission"),pe=L("loading");return h(),fe("div",Ve,[A("div",ke,[t(w,{modelValue:p.title,"onUpdate:modelValue":e[0]||(e[0]=o=>p.title=o),placeholder:"题目标题",clearable:"",class:"search-input",onKeyup:he(M,["enter"])},null,8,["modelValue"]),t(y,{modelValue:p.categoryId,"onUpdate:modelValue":e[1]||(e[1]=o=>p.categoryId=o),data:P.value,props:{label:"categoryName",children:"children",value:"id"},placeholder:"选择分类",clearable:"","check-strictly":"","render-after-expand":!1,class:"search-select"},null,8,["modelValue","data"]),t(s,{type:"primary",onClick:M},{default:n(()=>[...e[8]||(e[8]=[g("搜索",-1)])]),_:1}),t(s,{onClick:te},{default:n(()=>[...e[9]||(e[9]=[g("重置",-1)])]),_:1}),b((h(),_(s,{type:"primary",onClick:ae},{default:n(()=>[...e[10]||(e[10]=[g("新增",-1)])]),_:1})),[[x,"question:save"]]),b((h(),_(s,{type:"danger",disabled:!C.value.length,onClick:ie},{default:n(()=>[...e[11]||(e[11]=[g("批量删除",-1)])]),_:1},8,["disabled"])),[[x,"question:delete"]])]),b((h(),_(f,{data:U.value,"element-loading-delay":200,"element-loading-background":"transparent",onSelectionChange:le,class:"data-table"},{default:n(()=>[t(m,{type:"selection",width:"50"}),t(m,{prop:"title",label:"标题","min-width":"200","show-overflow-tooltip":""}),t(m,{prop:"categoryName",label:"分类",width:"150"}),t(m,{prop:"createTime",label:"创建时间",width:"170"}),t(m,{label:"操作",width:"150",fixed:G(B)?!1:"right"},{default:n(({row:o})=>[b((h(),_(s,{link:"",type:"primary",onClick:ge=>oe(o)},{default:n(()=>[...e[12]||(e[12]=[g("编辑",-1)])]),_:1},8,["onClick"])),[[x,"question:update"]]),b((h(),_(s,{link:"",type:"danger",onClick:ge=>se(o)},{default:n(()=>[...e[13]||(e[13]=[g("删除",-1)])]),_:1},8,["onClick"])),[[x,"question:delete"]])]),_:1},8,["fixed"])]),_:1},8,["data"])),[[pe,V.value]]),t(de,{"current-page":r.value,"onUpdate:currentPage":e[2]||(e[2]=o=>r.value=o),"page-size":k.value,"onUpdate:pageSize":e[3]||(e[3]=o=>k.value=o),total:N.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",class:"pagination",onSizeChange:$,onCurrentChange:$},null,8,["current-page","page-size","total"]),t(be,{"current-page":r.value,"total-pages":T.value,onPrev:Y,onNext:Z,onPageChange:ee,class:"mobile-pagination"},null,8,["current-page","total-pages"]),t(ce,{modelValue:v.value,"onUpdate:modelValue":e[7]||(e[7]=o=>v.value=o),title:Q.value,fullscreen:G(B),"close-on-click-modal":!1,onClosed:re},{footer:n(()=>[t(s,{onClick:e[6]||(e[6]=o=>v.value=!1)},{default:n(()=>[...e[15]||(e[15]=[g("取消",-1)])]),_:1}),t(s,{type:"primary",loading:q.value,onClick:ne},{default:n(()=>[...e[16]||(e[16]=[g("确定",-1)])]),_:1},8,["loading"])]),default:n(()=>[t(ue,{ref_key:"formRef",ref:E,model:a,rules:W,"label-width":"80px"},{default:n(()=>[t(z,{label:"标题",prop:"title"},{default:n(()=>[t(w,{modelValue:a.title,"onUpdate:modelValue":e[4]||(e[4]=o=>a.title=o),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),t(z,{label:"分类",prop:"categoryId"},{default:n(()=>[t(y,{modelValue:a.categoryId,"onUpdate:modelValue":e[5]||(e[5]=o=>a.categoryId=o),data:P.value,props:{label:"categoryName",children:"children",value:"id"},placeholder:"请选择分类","check-strictly":"","render-after-expand":!1,style:{width:"100%"}},null,8,["modelValue","data"])]),_:1}),t(z,{label:"内容",prop:"content"},{default:n(()=>[...e[14]||(e[14]=[A("div",{id:"vditor",class:"vditor-container",style:{width:"auto"}},null,-1)])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title","fullscreen"])])}}},Pe=me(Ce,[["__scopeId","data-v-e4bddc63"]]);export{Pe as default};
