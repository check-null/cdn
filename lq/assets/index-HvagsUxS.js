import{_ as Q,r as v,a as W,n as X,o as Y,g as d,V as Z,c as x,b,d as w,P as ee,e,w as l,F as I,x as S,f as ae,m as n,y as le,A as s,i as te,h as B,E as oe,M as ne}from"./index-Cd177lMO.js";import{M as se}from"./MobilePagination-BaHSNm3N.js";import{u as ue}from"./useIsMobile-DGJCqzpr.js";const re={class:"page-container"},ie={class:"search-bar"},de={class:"mono"},pe={class:"mono"},ce={__name:"index",setup(ve){const m=v(!1),P=v([]),f=v(0),p=v(1),g=v(10),{isMobile:T}=ue(),h=v(!1),u=v({}),r=W({operation:null,status:null,ip:""}),A=[{label:"登录",value:0},{label:"退出",value:1}],E=[{label:"成功",value:1},{label:"失败",value:0}],k=X(()=>Math.ceil(f.value/g.value)||1),C=o=>o===0?"登录":o===1?"退出":"-",N=o=>o?[o.country,o.region,o.city].filter(Boolean).join(" / "):"",_=()=>{m.value=!0,B("/sys/log/login/page",{pageNum:p.value,pageSize:g.value,operation:r.operation,status:r.status,ip:r.ip||void 0}).then(o=>{P.value=o.data.records||[],f.value=Number(o.data.total)||0,m.value=!1}).catch(()=>{m.value=!1})},z=()=>{ne(()=>{_()})},F=()=>{p.value>1&&(p.value--,_())},O=()=>{p.value<k.value&&(p.value++,_())},j=o=>{p.value=o,_()},y=()=>{p.value=1,_()},K=()=>{r.operation=null,r.status=null,r.ip="",y()},L=o=>{B("/sys/log/login/info",{id:o.id}).then(t=>{u.value=t.data||{},h.value=!0}).catch(()=>{oe.error("获取详情失败")})};return Y(()=>{_()}),(o,t)=>{const M=d("el-option"),U=d("el-select"),R=d("el-input"),V=d("el-button"),c=d("el-table-column"),D=d("el-tag"),$=d("el-table"),q=d("el-pagination"),i=d("el-descriptions-item"),G=d("el-descriptions"),H=d("el-drawer"),J=Z("loading");return b(),x("div",re,[w("div",ie,[e(U,{modelValue:r.operation,"onUpdate:modelValue":t[0]||(t[0]=a=>r.operation=a),placeholder:"操作类型",clearable:"",class:"search-select"},{default:l(()=>[(b(),x(I,null,S(A,a=>e(M,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),e(U,{modelValue:r.status,"onUpdate:modelValue":t[1]||(t[1]=a=>r.status=a),placeholder:"状态",clearable:"",class:"search-select"},{default:l(()=>[(b(),x(I,null,S(E,a=>e(M,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),e(R,{modelValue:r.ip,"onUpdate:modelValue":t[2]||(t[2]=a=>r.ip=a),placeholder:"IP",clearable:"",class:"search-input",onKeyup:ae(y,["enter"])},null,8,["modelValue"]),e(V,{type:"primary",onClick:y},{default:l(()=>[...t[6]||(t[6]=[n("搜索",-1)])]),_:1}),e(V,{onClick:K},{default:l(()=>[...t[7]||(t[7]=[n("重置",-1)])]),_:1})]),ee((b(),le($,{data:P.value,"element-loading-delay":200,"element-loading-background":"transparent",class:"data-table"},{default:l(()=>[e(c,{prop:"creatorName",label:"账号","min-width":"120"}),e(c,{label:"操作",width:"90"},{default:l(({row:a})=>[n(s(C(a.operation)),1)]),_:1}),e(c,{label:"状态",width:"90"},{default:l(({row:a})=>[e(D,{type:a.status===1?"success":"danger"},{default:l(()=>[n(s(a.status===1?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1}),e(c,{prop:"ip",label:"IP","min-width":"130"}),e(c,{label:"地区","min-width":"160"},{default:l(({row:a})=>[n(s(N(a)),1)]),_:1}),e(c,{prop:"platform",label:"平台","min-width":"120"}),e(c,{prop:"browser",label:"浏览器","min-width":"120"}),e(c,{prop:"createTime",label:"时间",width:"170"}),e(c,{label:"操作",width:"100",fixed:te(T)?!1:"right"},{default:l(({row:a})=>[e(V,{link:"",type:"primary",onClick:_e=>L(a)},{default:l(()=>[...t[8]||(t[8]=[n("详情",-1)])]),_:1},8,["onClick"])]),_:1},8,["fixed"])]),_:1},8,["data"])),[[J,m.value]]),e(q,{"current-page":p.value,"onUpdate:currentPage":t[3]||(t[3]=a=>p.value=a),"page-size":g.value,"onUpdate:pageSize":t[4]||(t[4]=a=>g.value=a),total:f.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",class:"pagination",onSizeChange:z,onCurrentChange:z},null,8,["current-page","page-size","total"]),e(se,{"current-page":p.value,"total-pages":k.value,onPrev:F,onNext:O,onPageChange:j,class:"mobile-pagination"},null,8,["current-page","total-pages"]),e(H,{modelValue:h.value,"onUpdate:modelValue":t[5]||(t[5]=a=>h.value=a),title:"登录日志详情",size:"420px","with-header":!0,"destroy-on-close":!0},{default:l(()=>[e(G,{column:1,border:""},{default:l(()=>[e(i,{label:"账号"},{default:l(()=>[n(s(u.value.creatorName||"-"),1)]),_:1}),e(i,{label:"操作"},{default:l(()=>[n(s(C(u.value.operation)),1)]),_:1}),e(i,{label:"状态"},{default:l(()=>[e(D,{type:u.value.status===1?"success":"danger"},{default:l(()=>[n(s(u.value.status===1?"成功":"失败"),1)]),_:1},8,["type"])]),_:1}),e(i,{label:"IP"},{default:l(()=>[n(s(u.value.ip||"-"),1)]),_:1}),e(i,{label:"位置"},{default:l(()=>[n(s(N(u.value)||"-"),1)]),_:1}),e(i,{label:"平台"},{default:l(()=>[n(s(u.value.platform||"-"),1)]),_:1}),e(i,{label:"浏览器"},{default:l(()=>[n(s(u.value.browser||"-"),1)]),_:1}),e(i,{label:"User-Agent"},{default:l(()=>[w("span",de,s(u.value.userAgent||"-"),1)]),_:1}),e(i,{label:"经纬度"},{default:l(()=>[w("span",pe,s(u.value.lon||"-")+" , "+s(u.value.lat||"-"),1)]),_:1}),e(i,{label:"时间"},{default:l(()=>[n(s(u.value.createTime||"-"),1)]),_:1}),e(i,{label:"备注"},{default:l(()=>[n(s(u.value.note||"-"),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},fe=Q(ce,[["__scopeId","data-v-51a87011"]]);export{fe as default};
