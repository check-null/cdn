import{_ as W,r as v,a as X,n as Y,o as Z,g as d,V as ee,c as x,b as f,d as P,P as ae,e,w as l,F as S,x as B,f as le,m as n,y as te,A as s,i as T,h as A,E as oe,M as ne}from"./index-BxFS-j2d.js";import{M as se}from"./MobilePagination-J8ddhRyS.js";import{u as ue}from"./useIsMobile-yINUZpTF.js";const re={class:"page-container"},ie={class:"search-bar"},de={class:"mono"},pe={class:"mono"},ce={__name:"index",setup(ve){const m=v(!1),k=v([]),b=v(0),p=v(1),g=v(10),{isMobile:w}=ue(),h=v(!1),u=v({}),r=X({operation:null,status:null,ip:""}),E=[{label:"登录",value:0},{label:"退出",value:1}],F=[{label:"成功",value:1},{label:"失败",value:0}],C=Y(()=>Math.ceil(b.value/g.value)||1),N=o=>o===0?"登录":o===1?"退出":"-",z=o=>o?[o.country,o.region,o.city].filter(Boolean).join(" / "):"",_=()=>{m.value=!0,A("/sys/log/login/page",{pageNum:p.value,pageSize:g.value,operation:r.operation,status:r.status,ip:r.ip||void 0}).then(o=>{k.value=o.data.records||[],b.value=Number(o.data.total)||0,m.value=!1}).catch(()=>{m.value=!1})},M=()=>{ne(()=>{_()})},O=()=>{p.value>1&&(p.value--,_())},j=()=>{p.value<C.value&&(p.value++,_())},K=o=>{p.value=o,_()},y=()=>{p.value=1,_()},L=()=>{r.operation=null,r.status=null,r.ip="",y()},R=o=>{A("/sys/log/login/info",{id:o.id}).then(t=>{u.value=t.data||{},h.value=!0}).catch(()=>{oe.error("获取详情失败")})};return Z(()=>{_()}),(o,t)=>{const U=d("el-option"),D=d("el-select"),$=d("el-input"),V=d("el-button"),c=d("el-table-column"),I=d("el-tag"),q=d("el-table"),G=d("el-pagination"),i=d("el-descriptions-item"),H=d("el-descriptions"),J=d("el-dialog"),Q=ee("loading");return f(),x("div",re,[P("div",ie,[e(D,{modelValue:r.operation,"onUpdate:modelValue":t[0]||(t[0]=a=>r.operation=a),placeholder:"操作类型",clearable:"",class:"search-select"},{default:l(()=>[(f(),x(S,null,B(E,a=>e(U,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),e(D,{modelValue:r.status,"onUpdate:modelValue":t[1]||(t[1]=a=>r.status=a),placeholder:"状态",clearable:"",class:"search-select"},{default:l(()=>[(f(),x(S,null,B(F,a=>e(U,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),e($,{modelValue:r.ip,"onUpdate:modelValue":t[2]||(t[2]=a=>r.ip=a),placeholder:"IP",clearable:"",class:"search-input",onKeyup:le(y,["enter"])},null,8,["modelValue"]),e(V,{type:"primary",onClick:y},{default:l(()=>[...t[6]||(t[6]=[n("搜索",-1)])]),_:1}),e(V,{onClick:L},{default:l(()=>[...t[7]||(t[7]=[n("重置",-1)])]),_:1})]),ae((f(),te(q,{data:k.value,"element-loading-delay":200,"element-loading-background":"transparent",class:"data-table"},{default:l(()=>[e(c,{prop:"creatorName",label:"账号","min-width":"120"}),e(c,{label:"操作",width:"90"},{default:l(({row:a})=>[n(s(N(a.operation)),1)]),_:1}),e(c,{label:"状态",width:"90"},{default:l(({row:a})=>[e(I,{type:a.status===1?"success":"danger"},{default:l(()=>[n(s(a.status===1?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1}),e(c,{prop:"ip",label:"IP","min-width":"130"}),e(c,{label:"地区","min-width":"160"},{default:l(({row:a})=>[n(s(z(a)),1)]),_:1}),e(c,{prop:"platform",label:"平台","min-width":"120"}),e(c,{prop:"browser",label:"浏览器","min-width":"120"}),e(c,{prop:"createTime",label:"时间",width:"170"}),e(c,{label:"操作",width:"100",fixed:T(w)?!1:"right"},{default:l(({row:a})=>[e(V,{link:"",type:"primary",onClick:_e=>R(a)},{default:l(()=>[...t[8]||(t[8]=[n("详情",-1)])]),_:1},8,["onClick"])]),_:1},8,["fixed"])]),_:1},8,["data"])),[[Q,m.value]]),e(G,{"current-page":p.value,"onUpdate:currentPage":t[3]||(t[3]=a=>p.value=a),"page-size":g.value,"onUpdate:pageSize":t[4]||(t[4]=a=>g.value=a),total:b.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",class:"pagination",onSizeChange:M,onCurrentChange:M},null,8,["current-page","page-size","total"]),e(se,{"current-page":p.value,"total-pages":C.value,onPrev:O,onNext:j,onPageChange:K,class:"mobile-pagination"},null,8,["current-page","total-pages"]),e(J,{modelValue:h.value,"onUpdate:modelValue":t[5]||(t[5]=a=>h.value=a),title:"登录日志详情",size:"420px","full-screen":T(w),"with-header":!0,"destroy-on-close":!0},{default:l(()=>[e(H,{column:1,border:""},{default:l(()=>[e(i,{label:"账号"},{default:l(()=>[n(s(u.value.creatorName||"-"),1)]),_:1}),e(i,{label:"操作"},{default:l(()=>[n(s(N(u.value.operation)),1)]),_:1}),e(i,{label:"状态"},{default:l(()=>[e(I,{type:u.value.status===1?"success":"danger"},{default:l(()=>[n(s(u.value.status===1?"成功":"失败"),1)]),_:1},8,["type"])]),_:1}),e(i,{label:"IP"},{default:l(()=>[n(s(u.value.ip||"-"),1)]),_:1}),e(i,{label:"位置"},{default:l(()=>[n(s(z(u.value)||"-"),1)]),_:1}),e(i,{label:"平台"},{default:l(()=>[n(s(u.value.platform||"-"),1)]),_:1}),e(i,{label:"浏览器"},{default:l(()=>[n(s(u.value.browser||"-"),1)]),_:1}),e(i,{label:"User-Agent"},{default:l(()=>[P("span",de,s(u.value.userAgent||"-"),1)]),_:1}),e(i,{label:"经纬度"},{default:l(()=>[P("span",pe,s(u.value.lon||"-")+" , "+s(u.value.lat||"-"),1)]),_:1}),e(i,{label:"时间"},{default:l(()=>[n(s(u.value.createTime||"-"),1)]),_:1}),e(i,{label:"备注"},{default:l(()=>[n(s(u.value.note||"-"),1)]),_:1})]),_:1})]),_:1},8,["modelValue","full-screen"])])}}},be=W(ce,[["__scopeId","data-v-9561cd11"]]);export{be as default};
